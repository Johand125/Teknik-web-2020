var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,e,d){c instanceof String&&(c=String(c));for(var a=c.length,b=0;b<a;b++){var f=c[b];if(e.call(d,f,b,c))return{i:b,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,e,d){c!=Array.prototype&&c!=Object.prototype&&(c[e]=d.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,e,d,a){if(e){d=$jscomp.global;c=c.split(".");for(a=0;a<c.length-1;a++){var b=c[a];b in d||(d[b]={});d=d[b]}c=c[c.length-1];a=d[c];e=e(a);e!=a&&null!=e&&$jscomp.defineProperty(d,c,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,d){return $jscomp.findInternal(this,c,d).v}},"es6","es3");var __extends=this&&this.__extends||function(c,e){function d(){this.constructor=c}for(var a in e)e.hasOwnProperty(a)&&(c[a]=e[a]);c.prototype=null===e?Object.create(e):(d.prototype=e.prototype,new d)},Assignment;
(function(c){(function(c){var d=function(){function a(b){var a=this;this.button=b;CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.replyToExtensionFrameWhenTopFrameExists,function(){a.button.show().on("click",function(){return a.openGroupChat()})});CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.askExtensionParentFrameWhetherTopFrameExists))}a.prototype.openGroupChat=
function(){var b={collaborationId:this.button.attr("data-collaborationId")};CCL.CommonFunctions.makePostMessageCallWithData(window.top,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.openGroupChat),b);return!1};return a}();c.GroupChatButton=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){c=c.AllInOneGraderActionAfterClose||(c.AllInOneGraderActionAfterClose={});c[c.RefreshPage=0]="RefreshPage";c[c.SendPostMessage=1]="SendPostMessage"})(Assignment||(Assignment={}));var Tools;
(function(c){var e=function(){function d(){}d.prototype.createToken=function(){this.token=new c.CancellationToken;this.cancelFunc=this.token.init();return this.token};d.prototype.cancel=function(){this.cancelFunc&&"function"===typeof this.cancelFunc&&this.cancelFunc()};return d}();c.CancellationTokenSource=e})(Tools||(Tools={}));
(function(c){var e=function(){function c(){}c.attachHandlerOnContainer=function(a){var b=this;a.find("."+Assignment.CssClasses.ExpandableSection.Arrow).attr("aria-expanded","true");a.find("."+Assignment.CssClasses.ExpandableSection.Section).attr("aria-hidden","false");a.on("click","."+Assignment.CssClasses.ExpandableSection.Arrow,function(f){return b.toggleSection(f,a)});a.keydown(function(f){return b.keyHandler(f,a)})};c.toggleSection=function(a,b){var f=$(a.target).attr("aria-controls"),c="true"===
$(a.target).attr("aria-expanded");b=b.find("#"+f);c?($(a.target).attr("aria-expanded","false"),b.attr("aria-hidden","true").hide(200)):($(a.target).attr("aria-expanded","true"),b.attr("aria-hidden","false").show(200))};c.keyHandler=function(a,b){$(a.target).hasClass(Assignment.CssClasses.ExpandableSection.Arrow)&&(a.which===CCL.CommonConstants.keyCodes.space?(this.toggleSection(a,b),a.preventDefault()):a.which===CCL.CommonConstants.keyCodes.arrowUp||a.which===CCL.CommonConstants.keyCodes.arrowDown?
(this.getNextExpander(a,b).focus(),a.preventDefault()):a.which===CCL.CommonConstants.keyCodes.home?(b.find("."+Assignment.CssClasses.ExpandableSection.Arrow).first().focus(),a.preventDefault()):a.which===CCL.CommonConstants.keyCodes.end&&(b.find("."+Assignment.CssClasses.ExpandableSection.Arrow).last().focus(),a.preventDefault()))};c.getNextExpander=function(a,b){b=b.find("."+Assignment.CssClasses.ExpandableSection.Arrow);var f=b.index(a.target),c=b.length;return b.get((f+c+(a.which===CCL.CommonConstants.keyCodes.arrowUp?
-1:1))%c)};return c}();c.ExpandableSection=e})(Tools||(Tools={}));
(function(c){(function(a){a[a.CustomCancel=0]="CustomCancel";a[a.NewRequest=1]="NewRequest";a[a.AjaxPostError=2]="AjaxPostError"})(c.RequestCancelReasons||(c.RequestCancelReasons={}));var e=c.RequestCancelReasons,d=function(){function a(b,a){void 0===a&&(a=1E3);this.requestUrl=b;this.delayBetweenRequests=a}a.prototype.load=function(b,a){var f=this;this.cancelLastRequest(e.NewRequest);var c=$.Deferred();this.currentLoadingDeferred=c;this.isQuicklyRequest?this.sendRequestTimeout=setTimeout(function(){f.sendRequestTimeout=
void 0;a.isCanceled?c.reject(e.CustomCancel):f.sendRequest(b,c,a)},this.delayBetweenRequests):this.sendRequest(b,c,a);this.isQuicklyRequest=!0;this.quicklyNavigateTimeout=setTimeout(function(){f.isQuicklyRequest=!1;f.quicklyNavigateTimeout=void 0},this.delayBetweenRequests);return c.promise()};a.prototype.sendRequest=function(b,a,c){CCL.CommonFunctions.safeAjaxPost({url:this.requestUrl,data:b,dataType:"JSON"}).done(function(b){c.isCanceled?a.reject(e.CustomCancel):a.resolve(b)}).fail(function(b,f,
d){c.isCanceled?a.reject(e.CustomCancel):a.reject(e.AjaxPostError,b,f,d)})};a.prototype.cancelLastRequest=function(b){this.quicklyNavigateTimeout&&(clearTimeout(this.quicklyNavigateTimeout),this.quicklyNavigateTimeout=void 0);this.sendRequestTimeout&&(clearTimeout(this.sendRequestTimeout),this.sendRequestTimeout=void 0);this.currentLoadingDeferred&&"pending"===this.currentLoadingDeferred.state()&&this.currentLoadingDeferred.reject(b)};return a}();c.RequestLimiter=d})(Tools||(Tools={}));
(function(c){var e=function(){return function(a,b,f){this.key=a;this.value=b;this.createdDate=f}}();c.JsDataCache=e;var d=function(){return function(){}}();c.JsDataCacheWorkerOptions=d;d=function(){function a(b){this.cache=[];this.expiryTime=b.expiryTime;this.cacheSize=b.cacheSize}a.prototype.getValue=function(b){for(var a=null,c=0;c<this.cache.length;c++)if(this.cache[c].key===b){a=this.cache[c];break}return a?(new Date).valueOf()-a.createdDate.valueOf()>this.expiryTime?(this.cache.splice(c,1),null):
a.value:null};a.prototype.addData=function(b,a){this.cache.length>this.cacheSize&&this.cache.shift();b=new e(b,a,new Date);this.cache.push(b)};a.prototype.clear=function(){this.cache.splice(0)};return a}();c.JsDataCacheWorker=d})(Tools||(Tools={}));
(function(c){var e=function(){function c(a,b){this.url=a;this.headersListUpdatedCallback=b;this.pagesCache=new Tools.JsDataCacheWorker({expiryTime:3E5,cacheSize:4})}c.prototype.initSingleMode=function(a){this.virtualCount=1;this.currentUserIndex=0;this.nextHeadersList=this.previousHeadersList=null;this.currentUserId=a.UserId;this.currentHeadersList=[];this.currentHeadersList.push(a)};c.prototype.init=function(a,b,f,c){var d=this;this.pageIndex=a;this.pageSize=b;this.currentUserId=f;this.nextHeadersList=
this.previousHeadersList=this.currentHeadersList=null;var g=$.Deferred();c?(this.currentHeadersList=c.HeaderViewModels,this.pagesCache.addData(a,c.HeaderViewModels),this.virtualCount=c.VirtualCount,this.updateCurrentUserIndex(),g.resolve(this.getCurrentHeader()),this.loadHeadersIfNeed()):this.loadHeadersPage(a).done(function(b){d.currentHeadersList=b;d.updateCurrentUserIndex();g.resolve(d.getCurrentHeader());d.loadHeadersIfNeed()});return g.promise()};c.prototype.clear=function(){this.virtualCount=
this.pageSize=this.pageIndex=0;this.currentUserIndex=this.currentUserId=void 0;this.nextHeadersList=this.previousHeadersList=this.currentHeadersList=null;this.pagesCache.clear()};c.prototype.getCurrentHeader=function(){return this.canRefresh?this.currentHeadersList[this.currentUserIndex]:null};c.prototype.getNextHeader=function(){if(!this.canNextNavigate())return null;this.currentUserIndex++;this.currentUserIndex>this.currentHeadersList.length-1&&(this.previousHeadersList=this.currentHeadersList,
this.currentHeadersList=this.nextHeadersList,this.nextHeadersList=null,this.pageIndex=this.getNextPageIndex(),this.currentUserIndex=0);var a=this.getCurrentHeader();this.currentUserId=a.UserId;this.loadHeadersIfNeed();return a};c.prototype.getPreviousHeader=function(){if(!this.canPreviousNavigate())return null;this.currentUserIndex--;0>this.currentUserIndex&&(this.nextHeadersList=this.currentHeadersList,this.currentHeadersList=this.previousHeadersList,this.previousHeadersList=null,this.pageIndex=
this.getPreviousPageIndex(),this.currentUserIndex=this.currentHeadersList.length-1);var a=this.getCurrentHeader();this.currentUserId=a.UserId;this.loadHeadersIfNeed();return a};Object.defineProperty(c.prototype,"canRefresh",{get:function(){return void 0!==this.currentUserIndex&&this.currentHeadersList&&this.currentHeadersList[this.currentUserIndex]?!0:!1},enumerable:!0,configurable:!0});c.prototype.canNextNavigate=function(){if(1>=this.virtualCount)return!1;if(this.currentUserIndex<this.currentHeadersList.length-
1){if(this.currentHeadersList)return!0}else if(this.nextHeadersList&&!this.isNextPageLoading&&!this.isPreviousPageLoading)return!0;return!1};c.prototype.canPreviousNavigate=function(){if(1>=this.virtualCount)return!1;if(0<this.currentUserIndex){if(this.currentHeadersList)return!0}else if(this.previousHeadersList&&!this.isNextPageLoading&&!this.isPreviousPageLoading)return!0;return!1};c.prototype.loadHeadersIfNeed=function(){this.checkToNeedLoadNextPage()&&this.loadNextPage();this.checkToNeedLoadPreviousPage()&&
this.loadPreviousPage()};c.prototype.checkToNeedLoadNextPage=function(){return!this.isNextPageLoading&&this.currentUserIndex>this.currentHeadersList.length-4&&!this.nextHeadersList?!0:!1};c.prototype.checkToNeedLoadPreviousPage=function(){return!this.isPreviousPageLoading&&3>this.currentUserIndex&&!this.previousHeadersList?!0:!1};c.prototype.loadNextPage=function(){var a=this;if(!this.isNextPageLoading){this.isNextPageLoading=!0;var b=this.getNextPageIndex();this.loadHeadersPage(b).done(function(b){a.nextHeadersList=
b}).always(function(){a.isNextPageLoading=!1;a.sendPageUpdatesNotification()})}};c.prototype.loadPreviousPage=function(){var a=this;if(!this.isPreviousPageLoading){this.isPreviousPageLoading=!0;var b=this.getPreviousPageIndex();this.loadHeadersPage(b).done(function(b){a.previousHeadersList=b}).always(function(){a.isPreviousPageLoading=!1;a.sendPageUpdatesNotification()})}};c.prototype.getPagesCount=function(){return Math.ceil(this.virtualCount/this.pageSize)};c.prototype.getNextPageIndex=function(){return this.pageIndex<
this.getPagesCount()-1?this.pageIndex+1:0};c.prototype.getPreviousPageIndex=function(){return 0<this.pageIndex?this.pageIndex-1:this.getPagesCount()-1};c.prototype.loadHeadersPage=function(a){var b=this,f=$.Deferred(),c=this.pagesCache.getValue(a);if(c)return f.resolve(c),f.promise();CCL.CommonFunctions.safeAjaxPost({url:this.url,data:{pageIndex:a,pageSize:this.pageSize},dataType:"JSON"}).done(function(c){b.virtualCount=c.VirtualCount;b.pagesCache.addData(a,c.HeaderViewModels);f.resolve(c.HeaderViewModels)}).fail(function(b,
a,c){f.reject(b,a,c);console.error("Error loading grader headers")});return f.promise()};c.prototype.updateCurrentUserIndex=function(){for(var a=0;a<this.currentHeadersList.length;a++)if(this.currentHeadersList[a].UserId===this.currentUserId){this.currentUserIndex=a;return}console.error("Current user not found in current headers page")};c.prototype.sendPageUpdatesNotification=function(){this.headersListUpdatedCallback&&"function"===typeof this.headersListUpdatedCallback&&this.headersListUpdatedCallback()};
return c}();c.AllInOneGraderHeadersLoader=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a,b,f,d){var g=this;this.$navigatePreviousButton=b;this.$navigateNextButton=f;this.headerRenderer=d;this.headersLoader=new c.AllInOneGraderHeadersLoader(a.HeadersPageUrl,function(){g.waitForUpdateNavigationStatus&&(g.waitForUpdateNavigationStatus=!1,g.updateNavigationButtonAvailableStatus())});this.toggleNextNavigationButton(!1);this.togglePreviousNavigationButton(!1);this.requestLimiter=new Tools.RequestLimiter(a.AnswerUrl,1E3)}d.prototype.init=function(a,
b,f){return null!=a.PageIndex&&void 0!=a.PageIndex&&null!=a.PageSize&&void 0!=a.PageSize&&!isNaN(a.PageSize)&&!isNaN(a.PageIndex)&&0<a.PageSize?this.initCommonMode(a,b,f):this.initSingleMode(a.UserId,b)};d.prototype.close=function(){this.headerRenderer.clearHeader();this.headersLoader.clear()};d.prototype.refreshCurrent=function(a){if(!this.canRefresh)return null;var b=this.headersLoader.getCurrentHeader();a=this.load(b.UserId,a);this.headerRenderer.setHeader(b.PersonReferenceList);return a};d.prototype.goToNext=
function(a){if(!this.canNextNavigate)return null;this.toggleNextNavigationButton(!1);var b=this.headersLoader.getNextHeader();a=this.load(b.UserId,a);this.headerRenderer.setHeader(b.PersonReferenceList);this.updateNavigationButtonAvailableStatus();return a};d.prototype.goToPrevious=function(a){if(!this.canPreviousNavigate)return null;this.togglePreviousNavigationButton(!1);var b=this.headersLoader.getPreviousHeader();a=this.load(b.UserId,a);this.headerRenderer.setHeader(b.PersonReferenceList);this.updateNavigationButtonAvailableStatus();
return a};Object.defineProperty(d.prototype,"canRefresh",{get:function(){return this.isRefreshAvailable&&this.headersLoader.canRefresh},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canNextNavigate",{get:function(){return this.isNextNavigateAvailable},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canPreviousNavigate",{get:function(){return this.isPreviousNavigateAvailable},enumerable:!0,configurable:!0});d.prototype.initSingleMode=function(a,b){var f=this;
this.$navigateNextButton.hide();this.$navigatePreviousButton.hide();a=this.load(a,b,!0);a.done(function(b){b&&b.HeaderViewModel&&(f.headersLoader.initSingleMode(b.HeaderViewModel),f.headerRenderer.setHeader(b.HeaderViewModel.PersonReferenceList))});return a};d.prototype.initCommonMode=function(a,b,f){var c=this;this.headersLoader.init(+a.PageIndex,+a.PageSize,a.UserId,f).done(function(b){c.headerRenderer.setHeader(b.PersonReferenceList);c.updateNavigationButtonAvailableStatus()});return this.load(a.UserId,
b)};d.prototype.load=function(a,b,f){var c=this;void 0===f&&(f=!1);this.isRefreshAvailable=!1;a=this.requestLimiter.load({userId:a,isSingleMode:f},b);a.always(function(){c.isRefreshAvailable=!0});return a};d.prototype.updateNavigationButtonAvailableStatus=function(){var a=this.headersLoader.canNextNavigate(),b=this.headersLoader.canPreviousNavigate();this.toggleNextNavigationButton(a);this.togglePreviousNavigationButton(b);a&&b||(this.waitForUpdateNavigationStatus=!0)};d.prototype.toggleNextNavigationButton=
function(a){this.isNextNavigateAvailable=a;this.$navigateNextButton.toggleClass(c.CssClasses.Grader.DisabledNavigationButtons,!a)};d.prototype.togglePreviousNavigationButton=function(a){this.isPreviousNavigateAvailable=a;this.$navigatePreviousButton.toggleClass(c.CssClasses.Grader.DisabledNavigationButtons,!a)};return d}();c.AllInOneGraderDataLoader=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a,b){this.$headerContainer=a;this.headerSettings=b}d.prototype.clearHeader=function(){this.printTitle="";this.$headerContainer.empty();this.showMoreActionMenu&&(this.showMoreActionMenu=void 0)};d.prototype.setHeader=function(a){this.clearHeader();1<a.length?(this.printTitle=this.headerSettings.GroupTerm,this.setHeaderWithPersonsList(a)):0<a.length&&(a=a[0],this.printTitle=a.FullName,this.setHeaderWithOnePerson(a))};d.prototype.getPrintTitle=function(){return this.printTitle};
d.prototype.setHeaderWithOnePerson=function(a){this.getPersonReference(a,!1,!0,!0).appendTo(this.$headerContainer)};d.prototype.setHeaderWithPersonsList=function(a){for(var b=$("<div>").addClass(this.headerSettings.ProfilePicturesContainerClass),f=$("<ul>").addClass(this.headerSettings.PersonReferenceListClass),c=null,d=0;d<a.length;d++){var e=a[d];if(d<this.headerSettings.MaxItemsShown)b.append(this.getProfilePicture(e)),$("<li>").addClass(this.headerSettings.PersonReferenceListItemClass).append(this.getPersonReference(e,
!0)).appendTo(f);else{c=this.getShowMoreLink(a.slice(this.headerSettings.MaxItemsShown));break}}b.appendTo(this.$headerContainer);f.appendTo(this.$headerContainer);c&&c.appendTo(this.$headerContainer)};d.prototype.getShowMoreLink=function(a){var b=this,f=$("<a>").prop("href","javascript:void(0);").append($("<span>").html(this.headerSettings.ShowMoreLinkTextTemplate?this.headerSettings.ShowMoreLinkTextTemplate.replace("{0}",a.length.toString()):"").addClass("h-mrl5")),d=[];a.forEach(function(a){var f=
b.getProfilePictureWithContainer(a).get(0).outerHTML;f+=b.getPersonReference(a,!1,!1).get(0).outerHTML;a=new CCL.ActionMenuItem(f,a.PersonId.toString(),function(b){b=parseInt(b.Id);c.Base.requestOpenProfileCard(b)});d.push(a)});a=new CCL.ActionMenuSettings;a.MenuZIndex=3006;this.showMoreActionMenu=new CCL.ActionMenu(f,d,a);return f};d.prototype.getPersonReference=function(a,b,f,c){void 0===b&&(b=!1);void 0===f&&(f=!0);void 0===c&&(c=!1);b=$("<span>").addClass(this.headerSettings.PersonReferenceClass).html(b&&
!a.HideDetails?CCL.CommonFunctions.htmlEncode(a.FirstName):CCL.CommonFunctions.htmlEncode(a.FullName));var d=$("<span>").addClass(this.headerSettings.PersonReferenceContainerClass).addClass(a.ContainerCssClass),g;c&&(g=this.getProfilePicture(a));!a.HideDetails&&f?(a=this.getProfileLink(a,this.headerSettings.HeaderPersonReferenceLinkClass,this.headerSettings.LinkTitleTextTemplate),g&&a.append(g),a.append(b).appendTo(d)):(g&&d.append(g),b.appendTo(d));return d};d.prototype.getProfilePictureWithContainer=
function(a){var b=this.getProfilePicture(a);a=$("<span>").addClass(this.headerSettings.ProfilePictureContainerClass).addClass(a.ContainerCssClass);b.appendTo(a);return a};d.prototype.getProfilePicture=function(a){return $("<img>").prop("alt","").attr("src",a.ProfilePictureUrl).addClass(this.headerSettings.ProfilePictureClass)};d.prototype.getProfileLink=function(a,b,f){b=$("<button type='button'>").attr("data-personid",a.PersonId).addClass(b);f&&(a=f.replace("{0}",a.FullName),b.attr("aria-label",
a));return b};return d}();c.AllInOneGraderHeaderRenderer=e})(Assignment||(Assignment={}));
(function(c){var e;(function(a){a[a.Next=0]="Next";a[a.Previous=1]="Previous"})(e||(e={}));var d=function(){function a(b){var a=this;this.hasChanges=this.isDialogOpen=!1;this.beforePrintAnswer=function(){if(a.isDialogOpen){var b=$("body");if(!b.hasClass(a.settings.CssClasses.PrintMode)){document.title=a.headerRenderer.getPrintTitle();var f=$("."+a.settings.CssClasses.AnswerContent+":visible"),c=$("."+a.settings.CssClasses.FileViewerContent+":visible");b.append(f).append(c).addClass(a.settings.CssClasses.PrintMode)}}};
this.afterPrintAnswer=function(){if(a.isDialogOpen){var b=$("body");b.removeClass(a.settings.CssClasses.PrintMode);var f=b.children("."+a.settings.CssClasses.AnswerContent);b=b.children("."+a.settings.CssClasses.FileViewerContent);$("#"+a.settings.AnswerContainerId).prepend(f);$("."+a.settings.CssClasses.FileViewerContainer).append(b)}};this.settings=b;window[c.Constants.ClientInstanceNames.AllInOneGrader]||(window[c.Constants.ClientInstanceNames.AllInOneGrader]=this);this.dialog=CCL.FullScreenDialog.getInstance();
this.$dialogContent=this.dialog.$dialog;this.$navigateNextBtn=this.$dialogContent.find("#"+c.Constants.ClientIds.AllInOneGraderHeaderNext);this.$navigatePreviousBtn=this.$dialogContent.find("#"+c.Constants.ClientIds.AllInOneGraderHeaderPrevious);this.informationFeedback=new c.InformationFeedbackWrapper("#"+c.Constants.ClientIds.AllInOneGraderContent);this.forgotToSave=new c.ForgotToSave(b.Terms.ForgotToSaveTermsModel,function(){return a.currentAssessment&&a.isDialogOpen?JSON.stringify(a.currentAssessment.initValues):
null},function(){return a.currentAssessment&&a.isDialogOpen?JSON.stringify(a.currentAssessment.getDataToSave()):null});this.forgotToSave.bindBrowserEvents();b=$("."+c.CssClasses.Grader.HeaderPersonReferenceContainer);this.headerRenderer=new c.AllInOneGraderHeaderRenderer(b,this.settings.HeaderSettings);this.dataLoader=new c.AllInOneGraderDataLoader(this.settings.Urls,this.$navigatePreviousBtn,this.$navigateNextBtn,this.headerRenderer);this.cancellationTokenSource=new Tools.CancellationTokenSource;
this.registerHandlers();c.Master.beforePrintCallback(this.beforePrintAnswer);c.Master.afterPrintCallback(this.afterPrintAnswer)}a.getInstance=function(){return window[c.Constants.ClientInstanceNames.AllInOneGrader]};a.prototype.clear=function(){this.currentAssessment&&this.currentAssessment.clear();c.Controls.Answer.clear();this.headerRenderer.clearHeader();this.teacherNotesClientId&&(CCL.CommentModule[this.teacherNotesClientId]=!1);this.commentsClientId&&(CCL.CommentModule[this.commentsClientId]=
!1)};a.prototype.isOpen=function(){return this.isDialogOpen};a.prototype.open=function(b,a){var f=this;this.dialog.openDialogWithContent("");var d=this.loadingStarted();this.actionAfterClose=b.ActionAfterClose?b.ActionAfterClose:c.AllInOneGraderActionAfterClose.RefreshPage;this.dataLoader.init(b,d,a).done(function(b){f.isDialogOpen=!0;f.hasChanges=!1;f.cancelableInit(b,d)}).fail(function(b){f.loadingFail(b)})};a.prototype.onClose=function(){this.cancellationTokenSource.cancel();this.isDialogOpen=
!1;this.clear();this.dataLoader.close();$(document.body).empty();$("<div>").addClass(c.CssClasses.Grader.LoadingIndicator).appendTo(document.body);switch(this.actionAfterClose){case c.AllInOneGraderActionAfterClose.SendPostMessage:CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.backToPreviousPage));break;default:var b=this.getCurrentPageUrl();document.location.replace(b)}};a.prototype.close=function(b,a){void 0===
a&&(a=!1);this.dialog.closeDialog();b&&(b=this.getCurrentPageUrl(),a&&(b=CCL.CommonFunctions.setQueryStringParameter(b,c.Constants.RequestParams.IsLastAnswerAssessed,(!0).toString())),document.location.replace(b))};a.prototype.getCurrentPageUrl=function(){var b=window.location.href,a=b.lastIndexOf("#");0<a&&(b=b.substring(0,a));return b=CCL.CommonFunctions.setQueryStringParameter(b,"OpenGraderWithUserId","")};a.prototype.updateComments=function(b,a){this.commentsClientId=b;this.teacherNotesClientId=
a;this.commentsClientId&&"string"===typeof this.commentsClientId&&(b=$("#"+this.commentsClientId).getCommentModuleObject())&&!b.isDataSourceFetchedAtLeastOnce()&&b.loadAndShow();this.teacherNotesClientId&&"string"===typeof this.teacherNotesClientId&&(b=$("#"+this.teacherNotesClientId).getCommentModuleObject())&&!b.isDataSourceFetchedAtLeastOnce()&&b.loadAndShow()};a.waitForAnswerOrFile=function(){var b=$("."+c.CssClasses.Grader.AnswerContainer);$("."+c.CssClasses.Grader.AnswerOrFileViewer).hide();
a.createLoadingIndicator(c.Constants.ClientIds.AnswerOrFileLoadingIndicator).appendTo(b)};a.endWaitForAnswerOrFile=function(){$("."+c.CssClasses.Grader.AnswerContainer).find("#"+c.Constants.ClientIds.AnswerOrFileLoadingIndicator).remove();$("."+c.CssClasses.Grader.AnswerOrFileViewer).show()};a.prototype.cancelableInit=function(b,a){a.isCanceled||(b.IsLastAnswerAssessed?this.close(!0,!0):(this.dialog.updateContentWithHtmlString(b.ContentHtml),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(this.$dialogContent),
a.isCanceled||(b.AssessmentSettingsModel&&(b.AnswerControlSettingsModel.ShowAnswerFileDirectly?c.Controls.Answer.loadViewer(b.AnswerControlSettingsModel.FileUrlForOpenDirectly):(this.currentAnswer=new c.Controls.Answer(b.AnswerControlSettingsModel),b.AnswerControlSettingsModel.ShowPeerAssessment&&(this.currentAnswer.peerAssessmentGridManager=new c.PeerAssessmentGridManager(b.AnswerControlSettingsModel.PeerAssessmentGridManagerSettings))),this.currentAssessment=new c.Assessment(b.AssessmentSettingsModel)),
a.isCanceled||(this.updateComments(b.CommentsClientId,b.TeacherNotesClientId),this.loadingComplete()))))};a.prototype.registerHandlers=function(){var b=this;$(this.dialog).on(CCL.FullScreenDialog.onCloseEvent,function(){return b.onClose()});$(document).on(CCL.FullScreenDialog.onCloseCancelableEvent,function(a){a.preventDefault();b.currentAssessment&&b.currentAssessment.isFeedbackAreaInFocus&&b.currentAssessment.updateInlineEditorText();b.forgotToSaveHandler().done(function(){a.originalEvent.detail.resolve()})});
$(document).on(c.Constants.Events.AssessmentSaved,function(){b.hasChanges=!0;b.informationFeedback.show(b.settings.Terms.AssessmentSaved).hide(5E3)});$(document).on(c.Constants.Events.PlagiarismRequested,function(){b.hasChanges=!0;b.informationFeedback.show(b.settings.Terms.PlagiarismReportRequested).hide(5E3)});$(document).on(c.Constants.Events.PlagiarismRequestCancel,function(){b.hasChanges=!0});$(document).on(c.Constants.Events.AnswersGridDataChanged,function(){b.hasChanges=!0});$(document).on(c.Constants.Events.AssessmentSaveFailed,
function(a,c,d){a=c&&0===c.status?b.settings.Terms.NoInternetConnection:"";c&&!0===c.isValidationError||("function"===typeof d?b.informationFeedback.showWithButton(b.settings.Terms.SavingAssessmentFailed,a,b.settings.Terms.TryAgain,d):b.informationFeedback.show(b.settings.Terms.SavingAssessmentFailed,a))});this.$dialogContent.on("click","#"+c.Constants.ClientIds.AllInOneGraderHeaderNext,function(){return b.navigateTo(e.Next)});this.$dialogContent.on("click","#"+c.Constants.ClientIds.AllInOneGraderHeaderPrevious,
function(){return b.navigateTo(e.Previous)});this.$dialogContent.on("click","."+c.CssClasses.Grader.ShowSidebarButton+", ."+c.CssClasses.Grader.HideSidebarButton,function(){b.$dialogContent.find("."+c.CssClasses.Grader.Content).toggleClass("hideAnswer")});$(document).on(c.Constants.Events.AnswerRefresh,function(){return b.refreshGraderWithoutConfirm()});$(window).keydown(function(a){return b.windowKeyHandler(a)});this.$dialogContent.find("."+CCL.CommonCssClasses.FullScreenDialog.Header).keydown(function(a){return b.headerKeyHandler(a)})};
a.prototype.windowKeyHandler=function(b){!this.isDialogOpen||b.keyCode!==CCL.CommonConstants.keyCodes.f5||b.ctrlKey||b.metaKey||b.altKey||b.shiftKey||(b.preventDefault(),this.dataLoader.canRefresh&&this.refreshGrader())};a.prototype.headerKeyHandler=function(b){b.keyCode===CCL.CommonConstants.keyCodes.arrowRight?this.isDialogOpen&&this.navigateTo(e.Next):b.keyCode===CCL.CommonConstants.keyCodes.arrowLeft&&this.isDialogOpen&&this.navigateTo(e.Previous)};a.prototype.refreshGrader=function(){var b=this;
this.currentAssessment&&this.currentAssessment.isFeedbackAreaInFocus&&this.currentAssessment.updateInlineEditorText();this.dataLoader.canRefresh&&this.forgotToSaveHandler().done(function(){b.refreshGraderWithoutConfirm()})};a.prototype.refreshGraderWithoutConfirm=function(){var b=this;if(this.dataLoader.canRefresh){var a=this.loadingStarted(),c=this.dataLoader.refreshCurrent(a);c&&c.done(function(f){b.cancelableInit(f,a)}).fail(function(a){b.loadingFail(a)})}};a.prototype.navigateTo=function(b){var a=
this;if(b===e.Next){if(!this.dataLoader.canNextNavigate)return}else if(!this.dataLoader.canPreviousNavigate)return;this.forgotToSaveHandler().done(function(){var f=a.loadingStarted(),c;(c=b===e.Next?a.dataLoader.goToNext(f):a.dataLoader.goToPrevious(f))&&c.done(function(b){a.cancelableInit(b,f)}).fail(function(b){a.loadingFail(b)})})};a.prototype.loadingStarted=function(){this.cancellationTokenSource.cancel();this.isLoading=!0;this.clear();this.$loadingIndicator||(this.$loadingIndicator=a.createLoadingIndicator(c.Constants.ClientIds.GraderLoadingIndicator));
this.dialog.updateContentWithHtmlString(this.$loadingIndicator.get(0).outerHTML);return this.cancellationTokenSource.createToken()};a.prototype.loadingComplete=function(){this.$dialogContent.find("#"+c.Constants.ClientIds.GraderLoadingIndicator).remove();this.isLoading=!1};a.prototype.loadingFail=function(b){switch(b){case Tools.RequestCancelReasons.AjaxPostError:console.error("Error loading data"),this.$dialogContent.find("#"+c.Constants.ClientIds.GraderLoadingIndicator).remove()}};a.createLoadingIndicator=
function(b){return $("<div>").attr("id",b).addClass(c.CssClasses.Grader.LoadingIndicator)};a.prototype.forgotToSaveHandler=function(){var b=this,a=$.Deferred();if(this.isLoading)return a.resolve(),a.promise();this.forgotToSave.checkCanILeave().done(function(f){switch(f){case c.LeaveAction.Cancel:a.reject();break;case c.LeaveAction.SaveAndContinue:b.currentAssessment.save().done(function(){a.resolve()}).fail(function(b){$(document).trigger(c.Constants.Events.AssessmentSaveFailed,[b]);a.reject()});
break;default:a.resolve()}});return a.promise()};return a}();c.AllInOneGrader=d})(Assignment||(Assignment={}));var Annotations;
(function(c){var e=CCL.CommonFunctions,d=CCL.CommonWindowMessages,a=function(){function b(b){this.settings=b;this.pdfjs=window.PDFJS;this.manager=new c.Manager(b);window.opener&&$("."+this.settings.CssClasses.CloseButton).hide()}b.prototype.init=function(){var b=this;(function(a){$.get(a).done(function(a){b.loadAnnotationApp(a.directUrl?a.directUrl:null)}).fail(function(){b.loadAnnotationApp(null)})})(this.settings.Urls.FileInfoUrl)};b.prototype.loadAnnotationApp=function(a){var f=this;if(!this.settings.IsOpenInCssModal){e.makePostMessageCall(window.parent,
new d.GenericMessageWithData(d.MessageNames.extensionContentOpened,{iframeWidth:-1,iframeHeight:-1}));e.makePostMessageCall(window.parent,new d.GenericMessageWithData(d.MessageNames.iframeAutoHeight,{enabled:!0}));if(this.settings.Onboarding){var k=this.settings.Onboarding.AddNoteDialogClientId;(new c.OnboardingTour).init(k,this.settings.OnboardingCssClasses)}$("."+this.settings.CssClasses.CloseButton).on("click",function(){e.makePostMessageCall(window.parent,new d.GenericMessageWithData(d.MessageNames.iframeAutoHeight,
{enabled:!1}));history.go(-1)})}$(function(){f.pdfjs.webViewerLoad(a,function(){var c=b.getPdfViewerInstance();f.settings.IsOpenInCssModal&&(c.disablePreviousStateCaching=!0,c.pdfViewer.removePageBorders=!0);c.setTitle(f.settings.FileName);c.preferences.set("disablePageMode",!0);c.viewerPrefs.disablePageMode=!0;if(a){c.eventBus.on("textlayerrendered",function(b){f.manager.renderLayer(b,c.pdfViewer.currentScale)});var d=function(b){f.manager.scaleChanged(c.pdfViewer.currentScale)};c.eventBus.on("scalechanged",
d);c.eventBus.on("zoomin",d);c.eventBus.on("zoomout",d)}else f.settings.ErrorMessage?c.error(f.settings.ErrorMessage):c.error(f.settings.Terms.ErrorOccured)},f.settings.PdfJsWorker,f.settings.PdfJsCmapsFolder,f.settings.FileName)})};b.clearPdfViewerInstance=function(){var a=b.getPdfViewerInstance();if(a)try{a.close()}catch(g){}};b.getPdfViewerInstance=function(){return window[b.pdfViewerInstanceName]};b.pdfViewerInstanceName="PDFViewerApplication";return b}();c.AnnotationApp=a})(Annotations||(Annotations=
{}));(function(c){var e=function(){function c(){}c.prototype.init=function(a,b){(new Assignment.Onboarding.Step(b,a,CCL.Onboarding.Extensions.OnboardingFeatures.AssignmentAddNote)).start()};return c}();c.OnboardingTour=e})(Annotations||(Annotations={}));(function(c){var e=function(){return function(){}}();c.AnnotationAttributesModel=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(a){var b=this;this.setArrow=function(a){b.clearArrowCss();switch(a){case c.sides.top:b.$boxElement.addClass(b.arrowCssClasses.top);break;case c.sides.bottom:b.$boxElement.addClass(b.arrowCssClasses.bottom)}};this.clearArrowCss=function(){b.$boxElement.removeClass(b.arrowCssClasses.top+" "+b.arrowCssClasses.right+" "+b.arrowCssClasses.bottom+" "+b.arrowCssClasses.left)};this.$boxElement=a.$boxElement;this.$within=a.$within;this.arrowCssClasses=a.arrowCssClasses}
c.prototype.showBox=function(a,b){a=this.createTargetElement(a,b);this.position(a)};c.prototype.hideBox=function(){this.$boxElement.hide()};c.prototype.createTargetElement=function(a,b){var c=$("<div></div>");b.append(c);c.css({left:a.left-b.offset().left,top:a.top-b.offset().top,width:a.width,height:a.height,position:"absolute",visibility:"hidden"});return c};c.prototype.position=function(a){var b=this;this.$boxElement.show().position({my:"center bottom-10",at:"center top",of:a,collision:"flipfit flipfit",
within:this.$within,using:function(c,d){b.$boxElement.css(c);b.side=b.getSide(d);b.setArrow(b.side);a.remove()}})};c.prototype.getSide=function(a){return this.isBoxCentered(a)?a.vertical:c.sides.inside};c.prototype.isBoxCentered=function(a){return a.target.width/4<Math.abs(a.target.left+a.target.width/2-(a.element.left+a.element.width/2))?!1:!0};c.sides={top:"top",bottom:"bottom",inside:"inside"};return c}();c.Box=e})(Annotations||(Annotations={}));
(function(c){var e=function(){return function(){}}();c.ArrowCssClassesModel=e})(Annotations||(Annotations={}));(function(c){var e=function(){return function(){}}();c.BoxSettingsModel=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(){this.cache={}}c.prototype.addPageItem=function(a,b){a=this.pageKey(a);this.cache.hasOwnProperty(a)||(this.cache[a]=[]);this.cache[a].push(b)};c.prototype.getByPage=function(a){a=this.pageKey(a);if(this.cache.hasOwnProperty(a)){a=this.cache[a];var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b}return null};c.prototype.delete=function(a,b){this.cache[this.pageKey(a)].splice(b,1)};c.prototype.update=function(a,b,c){this.cache[this.pageKey(a)][b]=
c};c.prototype.pageKey=function(a){return"page_"+a};return c}();c.MemoryDataStorage=e})(Annotations||(Annotations={}));(function(c){var e=function(){return function(){}}();c.Annotation=e})(Annotations||(Annotations={}));(function(c){var e=function(d){function a(){d.apply(this,arguments);this.LastPromise=null;this.Id=new c.AnnotationCacheId}__extends(a,d);return a}(c.Annotation);c.AnnotationCache=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(a){this.value=a}c.prototype.valueOf=function(){return this.value};return c}();c.LocalAnnotationIdType=e;e=function(){function c(a){this.value=a}c.prototype.valueOf=function(){return this.value};return c}();c.RemoteAnnotationIdType=e;e=function(){return function(){}}();c.AnnotationCacheId=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(){}c.adjustRectangles=function(a){return $.map(a,function(b){return{x:b.left?b.left:b.x,y:b.top?b.top:b.y,width:b.width,height:b.height}})};c.adjustToViewport=function(a,b){return $.map(a,function(a){return{x:(a.x-b.offsetX)*b.scale,y:(a.y-b.offsetY)*b.scale,width:a.width*b.scale,height:a.height*b.scale}})};c.adjustToDefaultScale=function(a,b){return $.map(a,function(a){return{x:(a.x-b.offsetX)/b.scale,y:(a.y-b.offsetY)/b.scale,width:a.width/b.scale,height:a.height/
b.scale}})};c.getRectanglesBounds=function(a){for(var b={left:Infinity,top:Infinity,right:-Infinity,bottom:-Infinity,width:0,height:0},c=0;c<a.length;c++){var d=a[c];b.top>d.top&&(b.top=d.top);b.right<d.right&&(b.right=d.right);b.bottom<d.bottom&&(b.bottom=d.bottom);b.left>d.left&&(b.left=d.left)}b.width=b.right-b.left;b.height=b.bottom-b.top;return b};return c}();c.RectanglesTransformation=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function d(a){this.searchById=function(a,f,d){for(var b=0;b<a.length;b++)if(d(a[b],f))return[a[b],b];return[new c.AnnotationCache,-1]};this.filterByLocalId=function(a,c){return a.Id.LocalId&&a.Id.LocalId.valueOf()===c.valueOf()};this.filterByRemoteId=function(a,c){return a.Id.RemoteId&&a.Id.RemoteId.valueOf()===c.valueOf()};this.cache=a}d.prototype.add=function(a,b,f){var d=b instanceof c.LocalAnnotationIdType,e=new c.AnnotationCache;$.extend(e,f);d?e.Id.LocalId=b:e.Id.RemoteId=
b;this.cache.addPageItem(a,e)};d.prototype.get=function(a,b){var f=b instanceof c.LocalAnnotationIdType;a=this.cache.getByPage(a);return this.searchById(a,b,f?this.filterByLocalId:this.filterByRemoteId)[0]};d.prototype.getIndex=function(a,b){var f=b instanceof c.LocalAnnotationIdType;a=this.cache.getByPage(a);return this.searchById(a,b,f?this.filterByLocalId:this.filterByRemoteId)[1]};d.prototype.getByPage=function(a){return this.cache.getByPage(a)};d.prototype.delete=function(a,b){b=this.getIndex(a,
b);this.cache.delete(a,b)};d.prototype.updateAnnotation=function(a,b,f,d){void 0===d&&(d=!0);var g=this.getIndex(a,b);b=this.get(a,b);d||(f.Text=b.Text);f.LastPromise=b.LastPromise;f.Id=b.Id;f.Id.RemoteId=new c.RemoteAnnotationIdType(parseInt(f.AnnotationId));this.cache.update(a,g,f)};return d}();c.MemoryDataStorageProvider=e})(Annotations||(Annotations={}));
(function(c){var e=function(d){function a(a){var b=this;d.call(this,a.boxSettings);this.isEditMode=!1;this.disableSaveButtonIfTextEmpty=function(){b.getTextAreaVal().trim()?b.saveButton.toggleHyperlink(!0):b.saveButton.toggleHyperlink(!1)};this.boxReposition=function(){var a=b.$boxElement.height();if(a!==b.boxHeight){var f=parseFloat(b.$boxElement.css("top"));switch(b.side){case c.Box.sides.bottom:var d=a-b.boxHeight;break;default:d=0}b.$boxElement.css("top",f-d);b.boxHeight=a}};this.onDelete=function(){b.isEditMode=
!1;b.deleteHandler();b.hide(0)};this.onUpdate=function(){b.saveButton.getIfHyperLinkEnabled()&&(b.isEditMode=!1,b.updateHandler(b.getTextAreaVal()),b.setText(b.getTextAreaVal()),b.toggleForEditing(),b.boxReposition())};this.show=function(a,f,d){b.isEditMode||(b.boxHeight=b.$boxElement.height(),a=b.addOffset(c.RectanglesTransformation.getRectanglesBounds(b.transformRectangles(a)),f),b.showBox(a,d),b.saveButton.is(":visible")&&b.toggleForEditing())};this.hide=function(a){void 0===a&&(a=0);b.isEditMode||
(0===a?b.hideBox():b.$boxElement.delay(a).hide(0))};this.forceHide=function(){b.isEditMode=!1;b.hideBox()};this.toggleForEditing=function(){b.$boxElement.find("."+b.cssClasses.AnnotationTooltipSaveButton+", ."+b.cssClasses.AnnotationTooltipEditButton).toggle();b.$boxElement.find("."+b.cssClasses.AnnotationTooltipDeleteButton+", ."+b.cssClasses.AnnotationTooltipCancelButton).toggle();b.$boxElement.find("."+b.cssClasses.AnnotationTooltipText+", ."+b.cssClasses.AnnotationTooltipTextareaContainer).toggle()};
this.hideForReadOnly=function(){b.$boxElement.find("."+b.cssClasses.AnnotationTooltipSaveButton+", ."+b.cssClasses.AnnotationTooltipEditButton+", "+("."+b.cssClasses.AnnotationTooltipDeleteButton+", ."+b.cssClasses.AnnotationTooltipCancelButton)).hide()};this.cssClasses=a.cssClasses;this.genericUserIcon=a.genericUserIcon;this.deleteHandler=a.onDelete;this.updateHandler=a.onUpdate;this.readOnlyMode=a.readOnlyMode;this.pageBorderSize=a.pageBorderSize;this.saveButton=this.$boxElement.find("."+this.cssClasses.AnnotationTooltipSaveButton);
this.textArea=this.$boxElement.find("."+this.cssClasses.AnnotationTooltipTextarea);this.readOnlyMode&&this.hideForReadOnly();this.initEvents()}__extends(a,d);a.prototype.initEvents=function(){var a=this;this.readOnlyMode||(this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipDeleteButton,this.onDelete),this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipCancelButton,function(){a.isEditMode=!1;a.toggleForEditing();a.boxReposition()}),this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipEditButton,
function(){a.$boxElement.find("."+a.cssClasses.AnnotationTooltipEditButton).getIfHyperLinkEnabled()&&(a.isEditMode=!0,a.textAreaHeight=parseFloat(a.$boxElement.find("."+a.cssClasses.AnnotationTooltipText).css("height")),a.textArea.css("height",a.textAreaHeight),a.toggleForEditing(),a.textArea.focus(),a.setTextAreaVal(a.getText()),a.disableSaveButtonIfTextEmpty(),a.boxReposition())}),this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipSaveButton,this.onUpdate),this.$boxElement.on("input",
"."+this.cssClasses.AnnotationTooltipTextarea,this.disableSaveButtonIfTextEmpty))};a.prototype.getText=function(){return this.$boxElement.find("."+this.cssClasses.AnnotationTooltipText).text()};a.prototype.setText=function(a){this.$boxElement.find("."+this.cssClasses.AnnotationTooltipText).text(a)};a.prototype.getTextAreaVal=function(){return this.textArea.val()};a.prototype.setTextAreaVal=function(a){this.textArea.val("");this.textArea.val(a)};a.prototype.setIcon=function(a){a?this.$boxElement.find("."+
this.cssClasses.AnnotationTooltipPersonAvatar+" img").prop("src",a):this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonAvatar+" img").prop("src",this.genericUserIcon)};a.prototype.setTitle=function(a){this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonName).text(a)};a.prototype.disableEditButton=function(a){a?this.$boxElement.find("."+this.cssClasses.AnnotationTooltipEditButton).toggleHyperlink(!0):this.$boxElement.find("."+this.cssClasses.AnnotationTooltipEditButton).toggleHyperlink(!1)};
a.prototype.addOffset=function(a,c){return{left:a.left+c.offset().left+this.pageBorderSize,top:a.top+c.offset().top+this.pageBorderSize,right:a.right+c.offset().left+this.pageBorderSize,bottom:a.bottom+c.offset().top+this.pageBorderSize,width:a.width,height:a.height}};a.prototype.transformRectangles=function(a){return $.map(a,function(a){return{left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height}})};return a}(c.Box);c.TooltipBox=e})(Annotations||(Annotations={}));
(function(c){var e=function(c){function a(a){var b=this;c.call(this,a.boxSettings);this.disablePostButtonIfTextEmpty=function(){b.textArea.val().trim()?b.postButton.toggleHyperlink(!0):b.postButton.toggleHyperlink(!1)};this.onPost=function(a){if(b.postButton.getIfHyperLinkEnabled()){var c=b.textArea.val();b.postHandler({text:c},a);b.textArea.val("")}};this.show=function(a,c){b.showBox(a,c);b.textArea.val("");b.textArea.focus();b.postButton.toggleHyperlink(!1)};this.cssClasses=a.cssClasses;this.genericUserIcon=
a.genericUserIcon;this.postHandler=a.onPost;this.cancelHandler=a.onCancel;this.postButton=this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPostButton);this.textArea=this.$boxElement.find("."+this.cssClasses.AnnotationTooltipTextarea);a.iconUrl?this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonAvatar+" img").prop("src",a.iconUrl):this.$boxElement.find("."+this.cssClasses.AnnotationTooltipPersonAvatar+" img").prop("src",this.genericUserIcon);this.initEvents()}__extends(a,c);
a.prototype.initEvents=function(){var a=this;this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipPostButton,this.onPost);this.$boxElement.on("click","."+this.cssClasses.AnnotationTooltipCancelButton,function(){a.cancelHandler();a.hideBox()});this.$boxElement.on("input","."+this.cssClasses.AnnotationTooltipTextarea,this.disablePostButtonIfTextEmpty)};return a}(c.Box);c.AddAnnotationBox=e})(Annotations||(Annotations={}));
(function(c){var e=function(c){function a(a){var b=this;c.call(this,a.boxSettings);this.show=function(a,c){b.showBox(a,c)};this.$boxElement.click(a.click)}__extends(a,c);return a}(c.Box);c.BubbleBox=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function d(a,b,c){this.$pageDiv=$(a);this.attributes=b;this.cssClasses=c;this.$textLayerDiv=$(this.$pageDiv.find(".textLayer"));this.number=parseInt(this.$pageDiv.attr("data-page-number"))}d.prototype.getPageDiv=function(){return this.$pageDiv};d.prototype.getTextLayerTransformScale=function(){return this.$textLayerDiv.height()/this.$pageDiv.height()};d.prototype.getDefaultScaleRectangles=function(a,b){b={scale:b,offsetX:this.$textLayerDiv.offset().left,offsetY:this.$textLayerDiv.offset().top};
a=c.RectanglesTransformation.adjustRectangles(a);return c.RectanglesTransformation.adjustToDefaultScale(a,b)};d.prototype.getActualScaleRectangles=function(a,b){b={scale:b,offsetX:0,offsetY:0};a=c.RectanglesTransformation.adjustRectangles(a);return c.RectanglesTransformation.adjustToViewport(a,b)};d.prototype.renderAnnotation=function(a,b,f,d){void 0===d&&(d=!1);f={scale:f*this.getTextLayerTransformScale(),offsetX:0,offsetY:0};b=c.RectanglesTransformation.adjustRectangles(b);b=c.RectanglesTransformation.adjustToViewport(b,
f);a=c.ShapeBuilder.createHighlight(b,this.cssClasses.AnnotationHighlight).attr(this.attributes.AnnotationId,a.AnnotationId).attr(this.attributes.AnnotationType,a.Type).attr(this.attributes.AnnotationComment,a.Text).addClass(this.cssClasses.AnnotationContainer+" "+this.cssClasses.TooltipAble);d&&a.attr(this.attributes.AnnotationIsLocal,"true");this.$textLayerDiv.append(a)};d.prototype.renderSelection=function(a,b){b={scale:b*this.getTextLayerTransformScale(),offsetX:0,offsetY:0};a=c.RectanglesTransformation.adjustRectangles(a);
a=c.RectanglesTransformation.adjustToViewport(a,b);a=c.ShapeBuilder.createHighlight(a,this.cssClasses.Selection).addClass(this.cssClasses.SelectionContainer);this.$textLayerDiv.prepend(a)};d.prototype.removeAnnotation=function(a){this.$textLayerDiv.find("."+this.cssClasses.AnnotationContainer+"["+this.attributes.AnnotationId+"="+a+"]").remove()};d.prototype.removeSelection=function(){this.getPageDiv().find("."+this.cssClasses.SelectionContainer).remove()};d.prototype.updateAnnotationId=function(a,
b){this.getPageDiv().find("["+this.attributes.AnnotationId+"="+a+"]").attr(this.attributes.AnnotationId,b).removeAttr(this.attributes.AnnotationIsLocal)};return d}();c.Page=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function d(a){var b=this;this.attrubutes={AnnotationId:"data-pdf-annotate-id",AnnotationIsLocal:"data-pdf-annotate-local",AnnotationComment:"data-pdf-annotate-comment",AnnotationType:"data-pdf-annotate-type"};this.scrollChanged=function(){b.selection&&b.tooltip.hide()};this.scaleChanged=function(a){b.scale=a;b.bubble&&b.bubble.hideBox();b.addAnnotation&&b.addAnnotation.hideBox();b.tooltip&&b.tooltip.hideBox()};this.attachTextLayerEvents=function(a,c){if(b.settings.IsReadOnly)if(CCL.CommonFunctions.isMobileDevice())$(a).on("touchstart",
b.tooltip.forceHide);else $(a).mouseup(b.tooltip.forceHide);else if(CCL.CommonFunctions.isMobileDevice())$(a).on("touchstart",b.triggerBubble);else $(a).mouseup(b.triggerBubble),$(a).mousedown(function(){b.selection&&b.selection.eraseNative()});$(a).on("click touchstart",function(a){$(a.target).parent().hasClass(b.settings.CssClasses.TooltipAble)||b.tooltip.forceHide()});$(a).on("click touchstart","."+b.settings.CssClasses.TooltipAble,function(a){return b.triggerTooltip(a,c)})};this.showAnnotationBox=
function(){b.selection.eraseNative();b.bubble.hideBox();b.addAnnotation.show(b.selection.getBoundary(),b.$viewer)};this.addAnnotationCancel=function(){b.selection.getPage().removeSelection()};this.createAnnotation=function(a){var f=b.selection.getPage(),d=f.getDefaultScaleRectangles(b.selection.getClientRects(),b.scale),e={FileId:b.settings.FileRepoId,Annotation:{Text:"text",Page:f.number},Shape:{Structure:JSON.stringify(d)},Comment:{Text:a.text}},g=b.uuid();a={Type:1,Text:a.text,AnnotationId:g,Page:f.number,
Structure:JSON.stringify(d),ProfileImageSmallUrl:b.settings.Urls.UserProfileImage,FullName:b.settings.UserFullName,HasEditPermission:!0};b.storage.add(f.number,new c.LocalAnnotationIdType(g),e,a).done(function(a){f.updateAnnotationId(g,a.AnnotationId);b.tooltip.annotation&&b.tooltip.annotation.AnnotationId===g&&(b.tooltip.annotation.AnnotationId=a.AnnotationId,b.tooltip.setText(a.Text),b.tooltip.isLocal=!1)}).fail(function(a){a.status===CCL.CommonConstants.httpStatusCodes.badRequest&&f.removeAnnotation(g)});
f.renderAnnotation(a,d,b.scale,!0);f.removeSelection();b.addAnnotation.hideBox()};this.removeAnnotation=function(){var a=b.tooltip.isLocal?new c.LocalAnnotationIdType(b.tooltip.annotation.AnnotationId):new c.RemoteAnnotationIdType(b.tooltip.annotation.AnnotationId);b.storage.delete(b.tooltip.annotation.Page,a);b.tooltip.page.removeAnnotation(b.tooltip.annotation.AnnotationId)};this.updateAnnotation=function(a){var f=b.tooltip.isLocal?new c.LocalAnnotationIdType(b.tooltip.annotation.AnnotationId):
new c.RemoteAnnotationIdType(b.tooltip.annotation.AnnotationId);b.storage.update(b.tooltip.annotation.Page,f,a).done(function(a){b.tooltip.annotation&&b.tooltip.annotation.AnnotationId===a.AnnotationId&&b.tooltip.setText(a.Text)})};this.triggerBubble=function(a){b.selection&&b.selection.getPage().removeSelection();b.selection=new c.TextSelection({pageDiv:$(a.target).closest(".page"),attributes:b.attrubutes,cssClasses:b.settings.CssClasses});if(b.selection.isEmpty())b.bubble.hideBox();else{a=b.selection.getPage();
var f=b.selection.getClientRects();f=a.getDefaultScaleRectangles(f,b.scale);a.renderSelection(f,b.scale);b.selection.saveDefaultScaleSelection(f);b.bubble.show(b.selection.getBoundary(),b.$viewer)}b.addAnnotation.hideBox();CCL.CommonFunctions.isMobileDevice()||b.tooltip.forceHide()};this.triggerTooltip=function(a,f){if(!b.tooltip.isEditMode){var d=$(a.currentTarget).attr(b.attrubutes.AnnotationId),e=$(a.currentTarget).attr(b.attrubutes.AnnotationIsLocal)?!0:!1;a=e?new c.LocalAnnotationIdType(d):new c.RemoteAnnotationIdType(parseInt(d));
b.storage.getAnnotationByPage(f.number,a).then(function(a){b.tooltip.annotation=a;b.tooltip.isLocal=e;b.tooltip.page=f;b.tooltip.setText(a.Text);b.tooltip.setTitle(a.FullName);b.tooltip.setIcon(a.ProfileImageSmallUrl);b.tooltip.disableEditButton(a.HasEditPermission);b.tooltip.show(f.getActualScaleRectangles(JSON.parse(a.Structure),b.scale),f.getPageDiv(),b.$viewer)})}};this.settings=a;var f=$("#viewerContainer"),d={top:a.CssClasses.BubbleArrowTop,bottom:a.CssClasses.BubbleArrowBottom},e={top:a.CssClasses.TooltipArrowTop,
bottom:a.CssClasses.TooltipArrowBottom};a.IsReadOnly||(this.bubble=new c.BubbleBox({boxSettings:{$boxElement:$("#bubbleBox"),$within:f,arrowCssClasses:d},click:this.showAnnotationBox}),this.addAnnotation=new c.AddAnnotationBox({boxSettings:{$boxElement:$("#addAnnotationBox"),$within:f,arrowCssClasses:e},onPost:this.createAnnotation,onCancel:this.addAnnotationCancel,iconUrl:a.Urls.UserProfileImage,cssClasses:a.CssClasses,genericUserIcon:a.Urls.DefaultPersonAvatar}));this.tooltip=new c.TooltipBox({boxSettings:{$boxElement:$("#tooltipBox"),
$within:f,arrowCssClasses:e},onDelete:this.removeAnnotation,onUpdate:this.updateAnnotation,readOnlyMode:a.IsReadOnly,cssClasses:a.CssClasses,genericUserIcon:a.Urls.DefaultPersonAvatar,pageBorderSize:a.IsOpenInCssModal?0:9});f.on("scroll",this.scrollChanged);this.storage=new c.ServerStorage(a)}d.prototype.renderLayer=function(a,b){this.$viewer=$("#viewer");this.scale=b;if(a.source.textLayerDiv.offsetParent){var f=new c.Page(a.source.textLayerDiv.offsetParent,this.attrubutes,this.settings.CssClasses);
this.storage.getByPage(f.number).then(function(a){for(var c=0;c<a.length;c++){var d=a[c];f.renderAnnotation(d,JSON.parse(d.Structure),b)}});this.attachTextLayerEvents(a.source.textLayerDiv,f)}};d.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,this.replacement)};d.prototype.replacement=function(a){var b=16*Math.random()|0;return("x"===a?b:b&3|8).toString(16)};return d}();c.Manager=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function d(a){var b=this;this.defaultContentType="application/json;charset=utf-8";this.failResponseHandler=function(a){a.status===CCL.CommonConstants.httpStatusCodes.internalServerError&&alert(b.settings.Terms.ErrorOccured);a.status===CCL.CommonConstants.httpStatusCodes.badRequest&&(a=jQuery.parseJSON(a.responseText),alert(a?a.Message:b.settings.Terms.ErrorOccured))};this.settings=a;this.endpoint=a.Urls.Endpoint;a=new c.MemoryDataStorage;this.cacheProvider=new c.MemoryDataStorageProvider(a)}
d.prototype.update=function(a,b,c){var f=this,d=this.cacheProvider.get(a,b).Text;this.cacheProvider.get(a,b).Text=c;var e=function(){var d=f.cacheProvider.get(a,b);return $.ajax({type:"PUT",url:f.endpoint,data:JSON.stringify({AnnotationId:d.AnnotationId,AnnotationCommentId:d.AnnotationCommentId,Text:c}),contentType:f.defaultContentType})},m=this.cacheProvider.get(a,b).LastPromise;if(m){var l=m.pipe(e);this.cacheProvider.get(a,b).LastPromise=l}else l=$.when(e());l.done(function(d){if(c!==d.Text){var e=
f.cacheProvider.get(a,b).LastPromise;if(null===e||e===l)f.cacheProvider.get(a,b).Text=d.Text}}).fail(function(c){c.status===CCL.CommonConstants.httpStatusCodes.badRequest&&(f.cacheProvider.get(a,b).Text=d);f.failResponseHandler(c)});return l};d.prototype.delete=function(a,b){var c=this,d=function(){var d=c.cacheProvider.get(a,b);return $.ajax({type:"DELETE",url:c.endpoint+"&annotationId="+d.AnnotationId,contentType:c.defaultContentType}).done(function(){c.cacheProvider.delete(a,b)}).fail(c.failResponseHandler)},
e=this.cacheProvider.get(a,b).LastPromise;e?e.pipe(d):d()};d.prototype.add=function(a,b,c,d){var f=this,e=$.ajax({type:"POST",url:this.endpoint,data:JSON.stringify(c),contentType:this.defaultContentType});d.LastPromise=e;this.cacheProvider.add(a,b,d);e.done(function(c){var d=f.cacheProvider.get(a,b).LastPromise===e;f.cacheProvider.updateAnnotation(a,b,c,d)}).fail(function(c){c.status===CCL.CommonConstants.httpStatusCodes.badRequest&&f.cacheProvider.delete(a,b);f.failResponseHandler(c)});return e};
d.prototype.getByPage=function(a){var b=this.cacheProvider.getByPage(a);return null===b?this.load([a]):$.Deferred().resolve(b)};d.prototype.getAnnotationByPage=function(a,b){b=this.cacheProvider.get(a,b);return null===b?this.load([a]):$.Deferred().resolve(b)};d.prototype.load=function(a){var b=this,d="";if(a)a=a.map(function(a,b){return"pages="+a}).reduce(function(a,b,c){return a+"&"+b},"");else throw Error("pages or page should be specified");0!==this.settings.AnnotationOfUserId&&(d="&userId="+this.settings.AnnotationOfUserId);
return $.get(this.endpoint+a+d).done(function(a,d,f){for(d=0;d<a.length;d++)b.cacheProvider.add(a[d].Page,new c.RemoteAnnotationIdType(a[d].AnnotationId),a[d])}).fail(this.failResponseHandler)};return d}();c.ServerStorage=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function c(){}c.createHighlight=function(a,b){var c=this,d=$("<div>");$.each(a,function(a,f){a=c.rectangleToDiv(f).addClass(b);d.append(a)});return d};c.rectangleToDiv=function(a){return $("<div>").css({left:a.x,top:a.y,width:a.width,height:a.height})};return c}();c.ShapeBuilder=e})(Annotations||(Annotations={}));
(function(c){var e=function(){function d(a){this.selection=window.getSelection();this.$pageDiv=$(a.pageDiv);this.attributes=a.attributes;this.cssClasses=a.cssClasses;this.offsetTop=this.$pageDiv.offset().top;this.offsetLeft=this.$pageDiv.offset().left;this.freeze()}d.prototype.getPage=function(){return new c.Page(this.$pageDiv,this.attributes,this.cssClasses)};d.prototype.getRectangles=function(){var a=this.selection.getRangeAt(0);return this.isBrowserIE()?this.clientRectsIEHack(a):a.getClientRects()};
d.prototype.getBoundingRect=function(){var a=this.selection.getRangeAt(0);return this.isBrowserIE()?(a=this.getRectangles(),c.RectanglesTransformation.getRectanglesBounds(a)):a.getBoundingClientRect()};d.prototype.getRange=function(){return this.selection.getRangeAt(0)};d.prototype.eraseNative=function(){window.getSelection&&(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges())};d.prototype.isEmpty=function(){return this.isBrowserIE()&&
0===this.selection.rangeCount?!0:0>=this.getRange().toString().length};d.prototype.freeze=function(){this.isBrowserIE()&&0===this.selection.rangeCount||(this.clientRects=this.getRectangles(),this.boundary=this.getBoundingRect())};d.prototype.saveDefaultScaleSelection=function(a){this.defaultScaleRectangles=a};d.prototype.getBoundary=function(){return this.recalculateRectPositionAfterScroll(this.boundary)};d.prototype.getClientRects=function(){var a=this;return $.map(this.clientRects,function(b){return a.recalculateRectPositionAfterScroll(b)})};
d.prototype.recalculateRectPositionAfterScroll=function(a){var b=this.$pageDiv.offset().top-this.offsetTop,c=this.$pageDiv.offset().left-this.offsetLeft;return{left:a.left+c,top:a.top+b,right:a.right+c,bottom:a.bottom+b,width:a.width,height:a.height}};d.prototype.isBrowserIE=function(){var a=window.navigator.userAgent;return 0<a.indexOf("Trident/")||0<a.indexOf("Edge/")};d.prototype.clientRectsIEHack=function(a){var b;"canvasWrapper"===a.startContainer.className&&a.setStart(a.startContainer.nextSibling.children[0].childNodes[0],
0);if(a.startContainer===a.commonAncestorContainer)return a.getClientRects();var c=[],d=a.cloneRange();d.setEnd(a.startContainer,a.startContainer.length);Array.prototype.push.apply(c,d.getClientRects());for(b=a.startContainer.parentNode.nextSibling;b!==a.endContainer.parentNode&&b&&!$(b).hasClass("endOfContent");)Array.prototype.push.apply(c,b.getClientRects()),b=b.nextSibling;d.setStart(a.endContainer,0);d.setEnd(a.endContainer,a.endOffset);Array.prototype.push.apply(c,d.getClientRects());return c};
return d}();c.TextSelection=e})(Annotations||(Annotations={}));(function(c){var e=function(){function c(){}c.prototype.init=function(){var a=this;return function(){a._isCanceled=!0}};Object.defineProperty(c.prototype,"isCanceled",{get:function(){return this._isCanceled},enumerable:!0,configurable:!0});c.prototype.then=function(a){if(this._isCanceled)return this;a();return this};return c}();c.CancellationToken=e})(Tools||(Tools={}));
(function(c){(function(c){var d=function(){function a(a,c){var b=this;this.hoverTargets=a;this.tooltip=c;this.toggleTooltipMobile=function(a){if(b.isTriggeredByHoverTarget(a))return b.tooltip.isVisibleForTarget(a.target)?b.tooltip.hide():(b.tooltip.hide(),b.tooltip.show($(a.target))),!1;b.tooltip.hide();return!0};this.onDeviceOrientationChanged=function(){return b.tooltip.hide()};0!==a.length&&(CCL.CommonFunctions.isMobileDevice()?($(document).on(this.toggleEventName,this.toggleTooltipMobile),$(window).on("orientationchange",
this.onDeviceOrientationChanged)):a.each(function(a,c){var d=$(c);d.on("mouseover",function(){return b.tooltip.show(d)}).on("mouseleave",function(){return b.tooltip.hide()})}))}Object.defineProperty(a.prototype,"toggleEventName",{get:function(){return CCL.CommonFunctions.isIosDevice()?"touchend":"click"},enumerable:!0,configurable:!0});a.prototype.isTriggeredByHoverTarget=function(a){for(var b=0;b<this.hoverTargets.length;b++)if(a.target===this.hoverTargets.get(b))return!0;return!1};return a}();c.TooltipToggler=
d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){(function(c){var d=function(){function a(b,c){this.tooltip=new CCL.CustomTooltip(b,{contentContainer:c,zIndex:10},a.tooltipCssClasses)}a.prototype.show=function(a){this.currentTarget=a.get(0);this.tooltip.openTooltip(a,{My:"center top",At:"center bottom+10",Arrow:"bottom"})};a.prototype.hide=function(){this.currentTarget=null;this.tooltip.closeTooltip()};a.prototype.isVisibleForTarget=function(a){return this.tooltip.isTooltipOpened()&&a===this.currentTarget};a.tooltipCssClasses={TooltipWrapper:"ccl-custom-tooltip",
TooltipArrow:"ccl-custom-tooltip-arrow",Bottom:"bottom",Left:"left",Top:"top",Right:"right"};return a}();c.Tooltip=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){var e=function(){function c(){$(document).on("click","a[data-personid], button[data-personid],",function(a){a=$(a.currentTarget);a=parseInt(a.data("personid"));c.requestOpenProfileCard(a)}).on(CCL.KeepAlive.unauthorisedEventName,function(){CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.reloadParentIframe))});this.scrollToTop()}c.prototype.scrollToTop=function(){CCL.CommonFunctions.makePostMessageCall(window.parent,
new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.scrollToTop))};c.requestOpenProfileCard=function(a){void 0===a&&(a=0);0<a&&CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessageWithData(CCL.CommonWindowMessages.MessageNames.openPersonProfileCard,a))};c.prototype.postMessageToShowSettings=function(a){void 0===a&&(a=!1);this.postMessage(CCL.CommonWindowMessages.MessageNames.showSettings,{ForceReload:a})};c.prototype.postMessageToHideSettings=
function(){CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.hideSettings))};c.prototype.postMessage=function(a,b){void 0===b&&(b=void 0);b?CCL.CommonFunctions.makePostMessageCallWithData(window.parent,new CCL.CommonWindowMessages.GenericMessage(a),b):CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(a))};return c}();c.Base=e})(Assignment||(Assignment={}));
(function(c){var e=function(){return function(c){this.navigateAwayMessage=c}}();c.BaseEditSettings=e;e=function(d){function a(a){var b=this;d.call(this);$("form").areYouSure({message:a.navigateAwayMessage,fieldEvents:"change",dirtyClass:c.CssClasses.AreYouSure.Dirty}).on("clean.areYouSure",function(){b.hasChanges=!0});$(document).ajaxError(function(){b.hasChanges&&$("form").addClass(c.CssClasses.AreYouSure.Dirty)})}__extends(a,d);return a}(c.Base);c.BaseEdit=e})(Assignment||(Assignment={}));
(function(c){(function(a){a[a.ContinueWithoutSave=0]="ContinueWithoutSave";a[a.SaveAndContinue=1]="SaveAndContinue";a[a.Cancel=2]="Cancel"})(c.LeaveAction||(c.LeaveAction={}));var e=c.LeaveAction,d=function(){function a(a,c,d){this.terms=a;this.getInitValuesFunc=c;this.getActualDataFunc=d}a.prototype.checkCanILeave=function(){var a=$.Deferred();if(this.compare())a.resolve(e.ContinueWithoutSave);else{var c=new CCL.ConfirmButtonMetaData(this.terms.SaveAndContinueButtonText,"ccl-button-color-green",
"SaveAndContinue"),d=new CCL.ConfirmButtonMetaData(this.terms.ContinueWithoutSaveButtonText,"","ContinueWithoutSave"),k=new CCL.ConfirmButtonMetaData(this.terms.CancelButtonText,"","Cancel");$.alerts&&"boolean"===typeof $.alerts.draggable&&($.alerts.draggable=!1);CCL.CommonFunctions.jAjaxMultiButtonConfirm(this.terms.Message?this.terms.Message:"",this.terms.Title?this.terms.Title:"",[c,d,k],function(b){switch(b.customId){case "SaveAndContinue":a.resolve(e.SaveAndContinue);break;case "ContinueWithoutSave":a.resolve(e.ContinueWithoutSave);
break;default:a.resolve(e.Cancel)}});c=$("#popup_container");0<c.length&&c.keyup(function(b){b.which===CCL.CommonConstants.keyCodes.escape&&(b.stopPropagation(),$.alerts._hide(),a.resolve(e.Cancel))})}return a.promise()};a.prototype.bindBrowserEvents=function(){if(this.browserEventsAreBinded)console.warn("You can't double bind browser events");else{var a=$.proxy(this.browserEventsHandler,this);$(window).on("beforeunload",a);this.browserEventsAreBinded=!0}};a.prototype.unbindBrowserEvents=function(){var a=
$.proxy(this.browserEventsHandler,this);$(window).off("beforeunload",a);this.browserEventsAreBinded=!1};a.prototype.browserEventsHandler=function(a){return this.compare()?void 0:this.terms.Message};a.prototype.compare=function(){var a=this.getActualDataFunc(),c=this.getInitValuesFunc();return c&&a?a===c:!0};return a}();c.ForgotToSave=d})(Assignment||(Assignment={}));
(function(c){var e=function(d){function a(a){var b=this;d.call(this,new c.BaseEditSettings(a.terms.navigateAway));this.bindEvent=function(){b.isAnswerOnBehalfOfTheStudent?(b.$answerOnBehalfOfTheStudentSaveButton.click(b.onSubmitAnswerClick),b.$answerOnBehalfOfTheStudentCancelButton.click(!0,b.onCancelClick.bind(b))):(b.$buttonSave.click(b.onSubmitAnswerClick),b.$buttonSaveDraft.click(!0,b.onSubmitAnswerClick),b.$buttonCancel.click(!0,b.onCancelClick.bind(b)))};this.onSubmitAnswerClick=function(a){b.handleError(!1);
var c=GetTextEditorContent(b.settings.controls.editorClientInstanceId),d=b.getPressedButton(a.data),f=window.document.getElementById(b.settings.controls.uploadAreaClientId)[b.settings.controls.uploadControlClientInstanceName];if(!f)throw Error("Instance of the file uploader is not found.");f=f.uploadedItems;var e=0<f.uploadMetadataArray.length+f.fileInCloudMetadataArray.length;0!==c.length||e?(b.$feedbackForEmptyAnswer.hide(),b.onGoingSaveRequest||(b.onGoingSaveRequest=CCL.CommonFunctions.safeAjaxPost({url:b.settings.urls.saveAnswerUrl,
data:{assignmentInstanceId:b.settings.data.assignmentInstanceId,assignmentId:b.settings.data.assignmentId,text:c,isDraft:a.data?!0:!1,UploadedItems:f,onBehalfOfUserId:b.settings.data.onBehalfOfUserId,isEditMode:b.settings.data.isEditMode}}).done(b.onAnswerSaveDone).fail(b.onAnswerSaveFail,function(){d.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator)}).always(function(){b.onGoingSaveRequest=null}))):(b.$feedbackForEmptyAnswer.show(),b.$feedbackForEmptyAnswer[0].scrollIntoView(!0),d.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator))};
this.onAnswerSaveDone=function(a){b.settings.data.isOpenedInIframe?b.triggerEventOnParentDocument(c.Constants.Events.AnswerSaved):(b.postMessageToShowSettings(!0),document.location.href=b.settings.urls.returnUrl)};this.onAnswerSaveFail=function(a){if(0===a.status)b.showErrorMessage(b.settings.terms.noInternetConnection);else try{var c=JSON.parse(a.responseText);b.handleError(!0,c)}catch(h){b.handleError(!0,null,b.settings.terms.cannotSaveAnswer)}};this.settings=a;this.isAnswerOnBehalfOfTheStudent=
this.settings.data.isAnswerOnBehalfOfTheStudent;this.settings.data.isOpenedInIframe||this.postMessageToHideSettings();this.$feedbackForError=$(this.settings.controls.feedbackForError);this.$feedbackForEmptyAnswer=$(this.settings.controls.feedbackForEmptyAnswer);this.$buttonSave=$(this.settings.controls.buttonSave);this.$buttonSaveDraft=$(this.settings.controls.buttonSaveDraft);this.$buttonCancel=$(this.settings.controls.buttonCancel);this.$answerOnBehalfOfTheStudentSaveButton=$(this.settings.controls.answerOnBehalfOfTheStudentSaveButton);
this.$answerOnBehalfOfTheStudentCancelButton=$(this.settings.controls.answerOnBehalfOfTheStudentCancelButton);this.bindEvent();new CCL.ButtonLoadingIndicator(this.$buttonSave,this.settings.data.inProgressClass,[this.$buttonSaveDraft],0);new CCL.ButtonLoadingIndicator(this.$buttonSaveDraft,this.settings.data.inProgressClass,[this.$buttonSave],0);new CCL.ButtonLoadingIndicator(this.$answerOnBehalfOfTheStudentSaveButton,this.settings.data.inProgressClass,null,0);CCL.IframeContentHeightReporter.addSelectorToListenHeight("#"+
this.settings.controls.fileDialogContainer)}__extends(a,d);a.prototype.showErrorMessage=function(a){this.$feedbackForError.show().find(".ccl-feedback-text").text(a);this.$feedbackForError[0].scrollIntoView(!0)};a.prototype.handleError=function(a,c,d){c&&this.showErrorMessage(c.ErrorMessage);d&&this.showErrorMessage(d);this.$feedbackForError.toggle(a)};a.prototype.getPressedButton=function(a){return this.isAnswerOnBehalfOfTheStudent?this.$answerOnBehalfOfTheStudentSaveButton:a?this.$buttonSaveDraft:
this.$buttonSave};a.prototype.onCancelClick=function(a){a.preventDefault();this.settings.data.isOpenedInIframe?this.triggerEventOnParentDocument(c.Constants.Events.AnswerClosed):(this.postMessageToShowSettings(),document.location.href=this.settings.urls.returnUrl)};a.prototype.triggerEventOnParentDocument=function(a,c){void 0===c&&(c=null);parent&&parent.$(parent.document).trigger(a,c)};return a}(c.BaseEdit);c.Answer=e})(Assignment||(Assignment={}));
(function(c){var e=function(d){function a(a){d.call(this,new c.BaseEditSettings(a.data.navigateAwayMessage));this.settings=a;new CCL.ButtonLoadingIndicator(this.settings.controls.okButtonSelector,this.settings.data.inProgressClass);$(this.settings.controls.okButtonSelector).click(this.handler.bind(this));$(this.settings.controls.manageRubricLinkSelector).click(this.showManageRubricHandler.bind(this))}__extends(a,d);a.prototype.showManageRubricHandler=function(){CCL.CommonFunctions.makePostMessageCall(window.parent,
{messageName:CCL.CommonWindowMessages.MessageNames.assignmentShowManageRubric})};a.prototype.handler=function(){!1===window.Page_IsValid&&$(this.settings.controls.okButtonSelector).trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator)};return a}(c.BaseEdit);c.AddEdit=e})(Assignment||(Assignment={}));
var BaseMetadata=function(){return function(c,e,d){this.name=c;this.sourceType=e;this.mimeType=d}}(),LocalFileInputHandle=function(){function c(c){this.fileInput=c}c.prototype.get=function(){return this.fileInput};return c}(),LocalFileHandle=function(){function c(c){this.file=c}c.prototype.get=function(){return this.file};return c}(),ExternalSourceFileHandle=function(){function c(c,d,a,b){this.url=c;this.id=d;this.canBeCopied=a;this.canBeShared=b}c.prototype.get=function(){return objectState.isNullOrUndefined(this.id)?
this.url:{url:this.url,id:this.id,canBeCopied:null==this.canBeCopied?!0:this.canBeCopied,canBeShared:null==this.canBeShared?!0:this.canBeShared}};return c}(),SourceType;(function(c){c[c.Dropbox=1]="Dropbox";c[c.Google=2]="Google";c[c.OneDriveForBusiness=3]="OneDriveForBusiness";c[c.Local=4]="Local";c[c.OneDrivePersonal=5]="OneDrivePersonal";c[c.WebDav=6]="WebDav";c[c.Ziggeo=7]="Ziggeo"})(SourceType||(SourceType={}));
(function(c){c.isOneDrive=function(e){return e===c.OneDrivePersonal||e===c.OneDriveForBusiness};c.isCloud=function(e){return e===c.Dropbox||e===c.Google||c.isOneDrive(e)||e===c.WebDav||e===c.Ziggeo}})(SourceType||(SourceType={}));
var FileInOneDriveHandle=function(){function c(c){this.postMessageFile=c}c.prototype.get=function(){return objectState.isNullOrUndefined(this.postMessageFile.id)?this.postMessageFile.url:{url:this.postMessageFile.url,viewUrl:this.postMessageFile.viewUrl,downloadUrl:this.postMessageFile.downloadUrl,id:this.postMessageFile.id,canBeCopied:null==this.postMessageFile.canBeCopied?!0:this.postMessageFile.canBeCopied,canBeShared:null==this.postMessageFile.canBeShared?!0:this.postMessageFile.canBeShared}};
return c}(),PickerFileResult=function(){function c(c,d,a,b,f,g){this.fileHandle=c;this.name=d;this.size=a;this.sourceType=b;this.relativePath=f;this.mimeType=g}c.prototype.getFileHandle=function(){return this.fileHandle.get()};c.createExternalSourcePickerFileResult=function(e,d,a,b,f,g,k,h){return new c(new ExternalSourceFileHandle(e,g,k,h),d,a,b,null,f)};c.createLocalPickerFileResultWithInput=function(e,d){return new c(new LocalFileInputHandle(e),d,null,SourceType.Local)};c.createLocalPickerFileResult=
function(e){return new c(new LocalFileHandle(e),e.name,e.size,SourceType.Local,null,e.type)};c.createFolderPickerFileResultWithRelativePath=function(e,d){return new c(new LocalFileHandle(e),e.name,e.size,SourceType.Local,d,e.type)};c.createPickerFileResultWithFileName=function(e){return new c(new LocalFileHandle(null),e,0,SourceType.Local,null,null)};c.createOneDrivePickerFileResult=function(e){return new c(new FileInOneDriveHandle(e),e.name,e.size,e.sourceType,null,e.mimeType)};return c}(),UploadMetadata=
function(c){function e(d,a,b,f,e,k,h,m,l){c.call(this,a,b,k);this.id=d;this.name=a;this.sourceType=b;this.signature=f;this.signedFileRepoId=e;this.mimeType=k;this.isTemplate=h;this.customId=m;this.originalFileId=l}__extends(e,c);e.updateName=function(c,a){c.name=a};e.setTemplate=function(c,a){c.isTemplate=a};e.create=function(c,a){var b=c.name,d=c.sourceType,g=c.mimeType,k=null,h=null,m=null,l=null;c=c.getFileHandle().id;a&&(a.fileGuid&&(k=a.fileGuid),a.signedGuid&&(h=a.signedGuid),a.signedFileRepoId&&
(m=a.signedFileRepoId),a.mimeType&&(g=a.mimeType),a.customId&&(l=a.customId));return new e(k,b,d,h,m,g,!1,l,c)};return e}(BaseMetadata);(function(c){var e=function(c){function a(a){c.call(this)}__extends(a,c);return a}(c.Base);c.AnswerTemplate=e})(Assignment||(Assignment={}));
(function(c){(function(c){var d=function(){function a(a){var b=this;this.addComment=function(a,c,d,f,e,p,n){CCL.CommonFunctions.safeAjaxPost({dataType:"json",url:b.settings.Urls.ControllerUrl,data:{learningObjectId:c.LearningObjectId,learningObjectInstanceId:c.LearningObjectInstanceId,assignmentInstanceAnswerId:c.AssignmentInstanceAnswerId,commentType:c.CommentType,text:d,lastVisibleCommentId:f},headers:CCL.CommonFunctions.getAntiForgeryAjaxHeader({headerName:b.settings.AntiForgerySettings.HeaderName,
headerValue:b.settings.AntiForgerySettings.HeaderValue})}).done(function(c){p(a,c);$(a).trigger(b.commentModuleChangeEvent)}).fail(function(b){n&&"function"===typeof n&&n(a,b)})};this.editComment=function(a,c,d,f,e,p,n){CCL.CommonFunctions.safeAjax({type:"PUT",dataType:"json",url:b.settings.Urls.ControllerUrl,data:{learningObjectId:c.LearningObjectId,learningObjectInstanceId:c.LearningObjectInstanceId,commentId:d,text:f},headers:CCL.CommonFunctions.getAntiForgeryAjaxHeader({headerName:b.settings.AntiForgerySettings.HeaderName,
headerValue:b.settings.AntiForgerySettings.HeaderValue})}).done(function(c){p(a,c);$(a).trigger(b.commentModuleChangeEvent)}).fail(function(b){n(a,d,b)})};this.deleteComment=function(a,c,d,f,e){CCL.CommonFunctions.safeAjax({type:"DELETE",url:b.settings.Urls.ControllerUrl,data:{learningObjectId:c.LearningObjectId,learningObjectInstanceId:c.LearningObjectInstanceId,commentId:d},headers:CCL.CommonFunctions.getAntiForgeryAjaxHeader({headerName:b.settings.AntiForgerySettings.HeaderName,headerValue:b.settings.AntiForgerySettings.HeaderValue})}).done(function(c){f(a,
d,c);$(a).trigger(b.commentModuleChangeEvent)}).fail(function(b){e(a,d,b)})};this.loadOld=function(a,c,d,f,e,p,n,q){$.ajax({type:"GET",url:b.settings.Urls.ControllerUrl,data:{learningObjectId:c.LearningObjectId,learningObjectInstanceId:c.LearningObjectInstanceId,assignmentInstanceAnswerId:c.AssignmentInstanceAnswerId,commentType:c.CommentType,commentId:d,count:f,numberOfPreviouslyReadItemsToDisplay:e}}).done(function(c){b.settings.ShowCommentModuleIfNoCommentsExist||0<c.Items.length?n(a,c):a.hide();
$(a).trigger(b.commentModuleChangeEvent)}).fail(function(b){q&&"function"===typeof q&&q(a,b)})};window[a]=this}a.prototype.initialize=function(a){this.settings=a;this.commentModuleChangeEvent=a.CommentModuleChangeEvent};return a}();c.CommentModuleManagerWrapper=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){(function(e){var d=function(){function a(b){this.settings=b;a.clearPlagiarismReportLinkUpdateTimeout();var d=$("#"+b.FileViewerEllipsisButtonIdentifier);this.answerSubmitOnBehalfControl=new e.AnswerSubmitOnBehalf(this.settings.SubmitOnBehalfSettingsModel);if(this.settings.HasAnswer){var g=$("#"+c.Constants.ClientIds.AnswerContainer),k=$("#"+c.Constants.ClientIds.AnswerFileViewer);Tools.ExpandableSection.attachHandlerOnContainer(g);k.on("click","."+c.CssClasses.FileViewer.BackLink,function(){k.hide().empty();
g.show();Annotations.AnnotationApp.clearPdfViewerInstance()});b.ShowActionMenu&&d.get(0)&&this.createActionMenu(d)}}a.loadViewer=function(a){c.AllInOneGrader.waitForAnswerOrFile();$.ajax({type:"GET",url:a}).done(function(a){$("#"+c.Constants.ClientIds.AnswerContainer).hide();$("#"+c.Constants.ClientIds.AnswerFileViewer).show().html(a)}).fail(function(a,b,d){c.AllInOneGrader.endWaitForAnswerOrFile();console.error(d)})};a.clear=function(){Annotations.AnnotationApp.clearPdfViewerInstance();a.clearPlagiarismReportLinkUpdateTimeout()};
a.updatePlagiarismMessage=function(a,c){a.isVisible=c.CanSendAnswerForPlagiarism;a.Value=c.UsePlagiarism?c.Terms.CancelRequestPlagiarism:c.Terms.RequestPlagiarism};a.setUsePlagiarism=function(b,d,e,k,h){k.isEnabled=!1;a.clearPlagiarismReportLinkUpdateTimeout();a.plagiarismReportLinkUpdateIsRequesting=!0;CCL.CommonFunctions.safeAjax({url:h.SetUsePlagiarismUrl,type:"PUT",dataType:"json",data:{answerId:e,usePlagiarism:!h.UsePlagiarism}}).done(function(b){h.UsePlagiarism=!h.UsePlagiarism;a.updatePlagiarismMessage(k,
h);h.UsePlagiarism?($(document).trigger(c.Constants.Events.PlagiarismRequested),b&&b.success&&b.reportLink&&a.plagiarismReportLinkUpdateIsRequesting&&($("#"+c.Constants.ClientIds.PlagiarismReportLinkContainer).html(b.reportLink),b.processing&&(a.plagiarismReportLinkUpdateTimeout=setTimeout(function(){a.updatePlagiarismLink(e,h.SetUsePlagiarismUrl)},a.poolingForNewReportInterval)))):($(document).trigger(c.Constants.Events.PlagiarismRequestCancel),b&&b.success&&$("#"+c.Constants.ClientIds.PlagiarismReportLinkContainer).html(""))}).always(function(){k.isEnabled=
!0;a.plagiarismReportLinkUpdateIsRequesting=!1})};a.updatePlagiarismLink=function(b,d,e){void 0===e&&(e=0);a.plagiarismReportLinkUpdateIsRequesting=!0;CCL.CommonFunctions.safeAjax({url:d+"?answerId="+b,type:"GET",dataType:"json"}).done(function(f){f&&f.success&&f.reportLink&&a.plagiarismReportLinkUpdateIsRequesting&&($("#"+c.Constants.ClientIds.PlagiarismReportLinkContainer).html(f.reportLink),f.processing&&e<a.poolingForNewReportMaxAttempts&&(a.plagiarismReportLinkUpdateTimeout=setTimeout(function(){a.updatePlagiarismLink(b,
d,e++)},a.poolingForNewReportInterval)))}).always(function(){a.plagiarismReportLinkUpdateIsRequesting=!1})};a.clearPlagiarismReportLinkUpdateTimeout=function(){a.plagiarismReportLinkUpdateTimeout&&clearTimeout(a.plagiarismReportLinkUpdateTimeout);a.plagiarismReportLinkUpdateIsRequesting=!1};a.prototype.createActionMenu=function(b){var d=this;this.actionMenu=new CCL.ActionMenu(b,null,new CCL.ActionMenuSettings(CCL.ActionMenuHorizontalPosition.Left,CCL.ActionMenuOpeningMode.Click,3006,!0,!0));this.settings.AnswerPlagiarismSettings.CanSendAnswerForPlagiarism&&
(this.plagiarismMenuItem=new CCL.ActionMenuItem("","SendPlagiarism",function(){a.setUsePlagiarism(d.settings.LearningObjectId,d.settings.LearningObjectInstanceId,d.settings.AnswerId,d.plagiarismMenuItem,d.settings.AnswerPlagiarismSettings)}),a.updatePlagiarismMessage(this.plagiarismMenuItem,this.settings.AnswerPlagiarismSettings),this.actionMenu.addItem(this.plagiarismMenuItem));this.settings.SubmitOnBehalfSettingsModel.SubmitOnBehalhUrl&&(b=new CCL.ActionMenuItem(this.settings.SubmitOnBehalfSettingsModel.EditAnswerTerm,
"EditAnswer",this.answerSubmitOnBehalfControl.openSubmitOnBehalfDialog),this.actionMenu.addItem(b));this.settings.PlagiarismReportUrl&&(b=new CCL.ActionMenuItem(this.settings.Terms.OpenPlagiarismReport,"OpenPlagiarismReport",function(){c.PlagiarismReport.openPlagiarismReport(d.settings.PlagiarismReportUrl)}),this.actionMenu.addItem(b));this.settings.PrintSettingsModel&&(b=new CCL.ActionMenuItem(this.settings.PrintSettingsModel.PrintTerm,"Print",function(){return window.print()}),this.actionMenu.addItem(b));
$("."+c.CssClasses.Grader.AnswerContainer).scroll(function(){d.actionMenu.close()})};a.poolingForNewReportInterval=2E4;a.poolingForNewReportMaxAttempts=30;return a}();e.Answer=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){var e=function(d){function a(a){var b=this;d.call(this,new c.BaseEditSettings(a.data.terms.navigateAwayMessage));this.postMessageToHideSettings();this.settings=a;this.$saveAndAssessButton=$(this.settings.controls.saveAndAssessNextButtonSelector);this.$submitButton=$(this.settings.controls.okButtonSelector);this.commentModule=$("#"+this.settings.controls.commentModule).getCommentModuleObject();this.teacherNoteModule=$("#"+this.settings.controls.teacherNoteModule).getCommentModuleObject();
this.commentsAndTeacherNotesContainer=$("#"+this.settings.controls.commentsAndTeacherNotesContainer);this.$commentsContainer=$('[data-contentid="#'+this.settings.controls.commentsContainer+'"]');this.$teacherNotesContainer=$('[data-contentid="#'+this.settings.controls.teacherNotesContainer+'"]');this.$commentTabs=$("#"+this.settings.controls.commentTabs);this.$filesSection=$("#"+this.settings.controls.filesSection);var e=document.getElementById(this.settings.controls.answerFileList);e&&e.addEventListener(this.settings.data.openPlagiarismReportEvent,
function(a){return c.FileList.openPlagiarismReport(a)});new CCL.ButtonLoadingIndicator(this.settings.controls.okButtonSelector,this.settings.data.cssClasses.inProgressClass,[this.settings.controls.saveAndAssessNextButtonSelector]);new CCL.ButtonLoadingIndicator(this.settings.controls.saveAndAssessNextButtonSelector,this.settings.data.cssClasses.inProgressClass,[this.settings.controls.okButtonSelector]);this.$submitButton.click(this.handler.bind(this));this.$saveAndAssessButton.click(this.handler.bind(this));
this.settings.controls.annotateFilesOnboardingDialog&&(new c.Onboarding.Step(this.settings.data.onboardingCssClasses,this.settings.controls.annotateFilesOnboardingDialog,CCL.Onboarding.Extensions.OnboardingFeatures.AssignmentAnnotateAnswerFiles)).start();0<this.$commentTabs.length?(this.$commentTabs.on(CCL.ControlTabsEvent.TabIndexChanged,function(a){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];c=c[0].selectedTab;c===b.settings.data.commentsTabIndex?b.loadCommentModule(b.commentModule):
c===b.settings.data.teacherNotesTabIndex&&b.loadCommentModule(b.teacherNoteModule);b.changeCommentModuleNoPrintClass()}),this.loadCommentModule(this.commentModule)):this.commentModule?(this.loadCommentModule(this.commentModule),this.changeCommentModuleNoPrintClass()):this.teacherNoteModule&&(this.loadCommentModule(this.teacherNoteModule),this.changeCommentModuleNoPrintClass());$(this.commentModule).add(this.teacherNoteModule).on(this.settings.data.commentModuleChangeEvent,function(){return b.changeCommentModuleNoPrintClass()});
$("#"+this.settings.controls.requestPlagiarismReportLink).on("click",function(){b.setUsePlagiarism(!0)});$("#"+this.settings.controls.requestPlagiarismReportCancelLink).on("click",function(){b.setUsePlagiarism(!1)});$(document).on(a.data.kpi.calculateEvent,$.proxy(function(){CCL.CommonFunctions.measureKpi(a.urls.measureKpi,a.data.kpi.measureSection,a.data.kpi.measurement)},this))}__extends(a,d);a.prototype.handler=function(){!1===window.Page_IsValid&&(this.$submitButton.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator),
this.$saveAndAssessButton.trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator))};a.prototype.loadCommentModule=function(a){a&&!a.isDataSourceFetchedAtLeastOnce()&&a.loadAndShow();this.currentCommentModule=a};a.prototype.changeCommentModuleNoPrintClass=function(){var a=this.currentCommentModule;this.commentsAndTeacherNotesContainer.add(this.$commentsContainer).add(this.$teacherNotesContainer).removeClass(this.settings.data.cssClasses.noPrint);0<a.getCommentsCountWithoutDeleted()?a===this.commentModule?
this.$teacherNotesContainer.addClass(this.settings.data.cssClasses.noPrint):a===this.teacherNoteModule&&this.$commentsContainer.addClass(this.settings.data.cssClasses.noPrint):this.commentsAndTeacherNotesContainer.addClass(this.settings.data.cssClasses.noPrint)};a.prototype.togglePlagiarismMessage=function(){$("#"+this.settings.controls.requestPlagiarismReport).add("#"+this.settings.controls.requestPlagiarismReportCancel).toggle()};a.prototype.setUsePlagiarism=function(a){var b=this;CCL.CommonFunctions.safeAjax({url:this.settings.urls.setUsePlagiarism,
type:"PUT",dataType:"json",data:{answerId:this.settings.data.answerId,usePlagiarism:a}}).done(function(){b.togglePlagiarismMessage()})};return a}(c.BaseEdit);c.AssessAnswer=e})(Assignment||(Assignment={}));
(function(c){var e=function(d){function a(a,f){d.call(this,new c.BaseEditSettings(f.Terms.NavigateAway));window[a]=this;this.settings=f;this.$validationError=$(this.settings.Controls.ValidationError)}__extends(a,d);a.prototype.validate=function(){this.assessmentControl=window[this.settings.Controls.AssessmentControlInstance];var a=!0;("undefined"!==typeof Page_ClientValidate?Page_ClientValidate():1)?this.settings.IsFeedbackMandatory&&IsEditorEmpty(this.settings.Controls.TextEditorClientId)&&this.isUploadedFilesListEmpty()?
a=!1:this.settings.IsFeedbackMandatory||!this.isAssessmentEmpty()||this.isScoreValid()||(a=!1):a=!1;this.$validationError.toggle(!a);a||this.$validationError.get(0).scrollIntoView();return a};a.prototype.isAssessmentEmpty=function(){var a=this.assessmentControl.getAssessment();return void 0===a||"0"===a||""===a};a.prototype.isScoreValid=function(){var a=this.assessmentControl.getScore();return a&&0<=parseFloat(a)};a.prototype.isUploadedFilesListEmpty=function(){var a=window.document.getElementById(this.settings.Controls.UploadAreaClientId)[this.settings.Controls.UploadControlClientInstanceName];
if(!a)throw Error("Instance of the file uploader is not found.");a=a.uploadedItems;return 0===a.uploadMetadataArray.length+a.fileInCloudMetadataArray.length};return a}(c.BaseEdit);c.AssessPeer=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function c(){}c.ClientInstanceNames={AllInOneGrader:"AllInOneGrader",AllInOneGraderDialog:"AllInOneGraderDialog",ReviewPeerAssessmentDialog:"ReviewPeerAssessmentDialog",RubricAssessment:"AssignmentRubricAssessment",HybridEditor:"AssignmentHybridEditor"};c.ClientIds={AllInOneGraderHeaderNext:"as-grader-header-next-button-id",AllInOneGraderHeaderPrevious:"as-grader-header-previous-button-id",AllInOneGraderContent:"as-grader-content-id",AnswerContainer:"as-answer-container-id",
PlagiarismReportLinkContainer:"as-plagiarism-report-link-container-id",AnswerFileViewer:"as-answer-file-viewer-container-id",GraderLoadingIndicator:"as-grader-loading-indicator-id",AnswerOrFileLoadingIndicator:"as-answer-or-file-loading-indicator-id"};c.Events={PlagiarismRequestCancel:"assessment:plagiarismrequestcancel",PlagiarismRequested:"assessment:plagiarismrequested",AssessmentSaved:"assessment:saved",AssessmentSaveFailed:"assessment:savefailed",RubricAssessmentClosed:"rubricAssessment:closed",
AnswersGridDataChanged:"answersgrid:datachanged",AnswerSaved:"answer:saved",AnswerRefresh:"answer:refresh",AnswerClosed:"answer:closed"};c.RequestParams={AnswerId:"AnswerId",IsLastAnswerAssessed:"IsLastAnswerAssessed"};c.ScoreAllowedCharacters=[CCL.CommonConstants.keyCodes.del,CCL.CommonConstants.keyCodes.backspace,CCL.CommonConstants.keyCodes.tab,CCL.CommonConstants.keyCodes.escape,CCL.CommonConstants.keyCodes.enter,CCL.CommonConstants.keyCodes.comma,CCL.CommonConstants.keyCodes.period,CCL.CommonConstants.keyCodes.decimalPoint];
c.UserSettingsKey={IsGoogleDocOnboardingCompleted:"IsGoogleDocOnboardingCompleted"};return c}();c.Constants=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function c(){}c.AreYouSure={Dirty:"as-dirty"};c.FileViewer={ContentContainer:"as-file-viewer-content",BackLink:"as-file-viewer-back-link"};c.Common={PersonProfileImage:"as-profile-picture-large",InformationFeedbackMessage:"as-info-feedback-message",Widont:"as-widont"};c.AddPeerDialog={Row:"as-add-peers-row",Image:"as-peer-image",Name:"as-peer-name",Remove:"as-remove-peer-link"};c.AutocompleteMenu={Menu:"as-autocomplete-menu"};c.Grader={Content:"as-grader-content",HeaderPersonReferenceContainer:"as-grader-header-person-reference-container",
ShowSidebarButton:"as-grader-show-sidebar-button",HideSidebarButton:"as-grader-hide-sidebar-button",AnswerContainer:"as-grader-answer-container",AnswerOrFileViewer:"as-grader-answer-or-file",DisabledNavigationButtons:"as-grader-header-navigation-disabled",LoadingIndicator:"as-grader-loading-indicator"};c.Assessment={ValidationError:"as-assessment-validationerror",ValidationErrorMessage:"as-assessment-validationerror-message",ReadMode:"as-assessment-read-mode",Mandatory:"as-mandatory",MandatoryLabel:"as-mandatory-field-label"};
c.ExpandableSection={Section:"as-expandable-section",Arrow:"as-expandable-arrow"};return c}();c.CssClasses=e})(Assignment||(Assignment={}));
(function(c){(function(e){var d=function(){function a(a){var b=this;this.settings=a;this.openSubmitOnBehalfDialog=function(){var a=window[b.settings.SubmitOnBehalfDialogClientInstanceName];a.setIframeUrl(b.settings.SubmitOnBehalhUrl,!1);a.openDialog(!1)};this.attachSubmitOnBehalfEvents()}a.prototype.attachSubmitOnBehalfEvents=function(){this.settings.SubmitOnBehalhUrl&&($("#"+this.settings.SubmitOnBehalfLinkId).on("click",this.openSubmitOnBehalfDialog),$(document).off(c.Constants.Events.AnswerClosed).on(c.Constants.Events.AnswerClosed,
function(){return CssModal.closeDialog()}),$(document).off(c.Constants.Events.AnswerSaved).on(c.Constants.Events.AnswerSaved,function(){CssModal.closeDialog();$(document).trigger(c.Constants.Events.AnswerRefresh)}))};return a}();e.AnswerSubmitOnBehalf=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a){var b=this;this.settings=a;window[d.clientInstanceName]=this;this.$score=$("#"+this.settings.Controls.ScoreClientId);this.$assessmentItems=$("#"+this.settings.Controls.AssessmentItemsClientId);this.$assessmentStatusItems=$("#"+this.settings.Controls.AssessmentStatusItemsClientId);this.$feedback=$("#"+this.settings.Controls.FeedbackClientId);this.$completeMenuLink=$("#"+this.settings.Controls.CompleteMenuLinkClientId);this.$completed=$("#"+this.settings.Controls.CompleteHiddenClientId);
this.$feedbackText=$("#"+this.settings.Controls.FeedbackTextClientId);this.$feedbackBlock=$("#"+this.settings.Controls.FeedbackBlockClientId);this.$contentContainer=$("."+this.settings.CssClasses.ContentContainer);this.$saveAssessmentButton=$("#"+a.Controls.SaveAssessmentClientId).click(function(a){a.preventDefault();b.onSaveClick()});$("#"+a.Controls.EditAssessmentClientId).click(function(){return b.toggleReadEditMode(!1)});$("#"+a.Controls.CompleteLinkClientId).click(function(){return b.setComplete(!0)});
$("#"+a.Controls.IncompleteLinkClientId).click(function(){return b.setComplete(!1)});$("."+a.Controls.AssessmentStatusLinkClientId).click(function(a){b.$assessmentStatusItems.text($(a.currentTarget).text());b.$assessmentStatusItems.attr("data-status-id",$(a.currentTarget).attr("data-status-id"))});this.rubricAssessmentControl=c.Controls.RubricAssessment.getInstance;this.attachRubricAssessmentEvents();this.initFeedbackTextExpander();this.$score.keydown(function(a){return b.onScoreKeyDown(a)});this.hybridEditorItemWrapper=
c.HybridEditorItemWrapper.getInstance;this.hybridEditorItemWrapper.connectHybridEditor();this.initValues=this.getDataToSave()}d.prototype.initFeedbackTextExpander=function(){d.feedbackTextExpander=new CCL.ContentBlockExpander(this.$feedbackText,this.settings.FeedbackExpanderSettingsModel)};d.getInstance=function(){return window[d.clientInstanceName]};Object.defineProperty(d.prototype,"isFeedbackAreaInFocus",{get:function(){return 0<this.$feedback.find("textarea:focus").length},enumerable:!0,configurable:!0});
d.prototype.clear=function(){this.clearUploader();this.rubricAssessmentControl&&this.rubricAssessmentControl.clear()};d.prototype.save=function(){var a=$.Deferred();if(!this.isValid())return a.reject({isValidationError:!0}),a.promise();CCL.CommonFunctions.safeAjaxPost({url:this.settings.PostUrl,data:this.getDataToSave(),dataType:"json"}).done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)});return a.promise()};d.prototype.getDataToSave=function(){var a=null;this.uploadControlInstance&&(a=
this.uploadControlInstance.uploadedItems);return{Score:this.$score.val(),AssessmentItemId:+this.$assessmentItems.val(),FeedbackTextValue:$.trim(this.hybridEditorItemWrapper.getText()),FeedbackTextHtml:"",Completed:this.$completed.val()===(!0).toString(),AssessmentStatusItemId:+this.$assessmentStatusItems.attr("data-status-id"),UploadedItems:a,LearningObjectiveAssessments:this.rubricAssessmentControl.get(this.settings.UserId)}};d.prototype.updateInlineEditorText=function(){this.hybridEditorItemWrapper.updateInlineEditorText()};
Object.defineProperty(d.prototype,"uploadControlInstance",{get:function(){var a=this.uploadArea;return a?a[this.settings.Controls.UploadControlClientInstanceName]:null},enumerable:!0,configurable:!0});d.prototype.clearUploader=function(){var a=this.uploadControlInstance;a&&a.dispose()};d.prototype.onSaveClick=function(){var a=this;this.save().done(function(b){a.toggleReadEditMode(!0,b);$(document).trigger(c.Constants.Events.AssessmentSaved);a.initValues=a.getDataToSave()}).fail(function(b){$(document).trigger(c.Constants.Events.AssessmentSaveFailed,
[b,function(){a.onSaveClick()}])})};d.prototype.isValid=function(){if(this.$completed.val()===(!0).toString()){if(!d.validateInput(this.$score,"")||!d.validateInput(this.$assessmentItems,"0"))return!1}else this.clearValidationErrors();return!0};d.prototype.clearValidationErrors=function(){this.$score.add(this.$assessmentItems).removeClass(c.CssClasses.Assessment.ValidationError);$("."+c.CssClasses.Assessment.ValidationErrorMessage).hide()};d.validateInput=function(a,b){return 0<a.length?(b=a.val()!==
b,a.toggleClass(c.CssClasses.Assessment.ValidationError,!b),$("."+c.CssClasses.Assessment.ValidationErrorMessage,a.parent()).toggle(!b),b):!0};d.prototype.setComplete=function(a){this.$completed.val(a.toString());this.toggleMandatory(a);a||this.clearValidationErrors();this.$completeMenuLink.text(a?this.settings.Terms.Complete:this.settings.Terms.Incomplete)};d.prototype.onScoreKeyDown=function(a){CCL.CommonFunctions.preventInputIncorrectCharacters(a,c.Constants.ScoreAllowedCharacters)};d.prototype.toggleMandatory=
function(a){this.settings.ShowMandatoryMarks&&(this.$contentContainer.find("."+c.CssClasses.Assessment.MandatoryLabel).toggleClass(c.CssClasses.Assessment.Mandatory,a),this.$score.add(this.$assessmentItems).attr("aria-required",a.toString()))};d.prototype.toggleReadEditMode=function(a,b){void 0===b&&(b=null);this.$contentContainer.toggleClass(c.CssClasses.Assessment.ReadMode,a);this.toggleFeedback(a,b?b.FeedbackTextHtml:null,b?b.FeedbackTextValue:null,b?b.HasFiles:!1);if(a){var d=this.uploadControlInstance;
d&&"function"===typeof d.removeFilesWithErrors&&d.removeFilesWithErrors();d=b.Score?b.Score:this.settings.Terms.NotAssessed;var e=this.$assessmentItems.find("option:selected").text();$("#"+this.settings.Controls.ScoreTextClientId).text(d);$("#"+this.settings.Controls.AssessmentItemsTextClientId).text(e);$("#"+this.settings.Controls.AssessmentStatusItemsTextClientId).text(this.$assessmentStatusItems.text());$("#"+this.settings.Controls.CompleteMenuLinkTextClientId).text(this.$completeMenuLink.text());
$("#"+this.settings.Controls.ReviewedByTextClientId).html(b.ReviewedByPersonReferenceHtml)}this.toggleMandatory(!a&&this.$completed.val()===(!0).toString())};d.prototype.toggleFeedback=function(a,b,c,e){a?b&&c?(this.$feedbackText.html(b),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(this.$feedbackText),this.hybridEditorItemWrapper.setText(b,c),d.feedbackTextExpander.renderShowMoreLinkIfNeed(!1)):(this.$feedback.val(""),this.$feedbackText.text(""),this.hybridEditorItemWrapper.setText("",
""),e||this.$feedbackBlock.hide()):(this.$feedbackBlock.show(),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(this.$feedbackText))};d.prototype.attachRubricAssessmentEvents=function(){var a=this;$("#"+this.settings.Controls.RubricButtonClientId).click(function(){a.rubricAssessmentControl.open(a.settings.UserId,a.settings.RubricAssessment,a.settings.RubricAssessmentsMasterySettings)&&(a.initValues.LearningObjectiveAssessments=a.rubricAssessmentControl.get(a.settings.UserId))});$("#"+
this.settings.Controls.ViewRubricLinkClientId).click(function(){a.rubricAssessmentControl.open(a.settings.UserId,a.settings.RubricAssessment,a.settings.RubricAssessmentsMasterySettings,!0)&&(a.initValues.LearningObjectiveAssessments=a.rubricAssessmentControl.get(a.settings.UserId))});$(document).on(c.Constants.Events.RubricAssessmentClosed,function(){a.rubricAssessmentControl.isEmpty(a.settings.UserId)||a.toggleRubricButton();a.changeAssessment(a.rubricAssessmentControl.getAssessment(a.settings.UserId));
a.changeScore(a.rubricAssessmentControl.getScore(a.settings.UserId))})};d.prototype.toggleRubricButton=function(){$("#"+this.settings.Controls.RubricButtonClientId).text(this.settings.Terms.EditRubric)};d.prototype.changeAssessment=function(a){null!=a&&this.$assessmentItems.val(a)};d.prototype.changeScore=function(a){null!=a&&this.$score.val(a)};Object.defineProperty(d.prototype,"uploadArea",{get:function(){return window.document.getElementById(this.settings.Controls.UploadAreaClientId)},enumerable:!0,
configurable:!0});d.clientInstanceName="AssignmentAssessmentControl";return d}();c.Assessment=e})(Assignment||(Assignment={}));
(function(c){(function(e){var d=function(){function a(a,c){var b=this;window[a]=this;this.settings=c;this.$completedToggle=$("#"+c.Controls.CompletedToggle);this.$scoreText=$("#"+c.Controls.Score);this.$assessment=$("#"+c.Controls.Assessment);this.$loAssessmentState=$("#"+c.Controls.LoAssessmentState);this.$rubricCriterias=$("#"+c.Controls.RubricCriterias);this.rubricToggleChangeValue=c.RubricToggleChangeValue;this.$simplifiedAssessmentStatusList=$("#"+c.Controls.SimplifiedAssessmentStatusList);var d=
$("#"+c.Controls.AssessmentOrScoreFeedback),f=$("#"+c.Controls.CompletedToggleLabel),e=$("#"+c.Controls.AssessmentLabel+", #"+c.Controls.ScoreLabel),l=$("#"+c.Controls.FieldIsMandatoryInformationMessage);this.$scoreText.add(this.$assessment).change(function(){d.hide()});this.$completedToggle.on(c.ToggleStateChangedEventName,function(a,d){a=window[d.toggleInstanceId];f.html(a.isChecked()?c.Terms.CompletedToggleOn:c.Terms.CompletedToggleOff);e.toggleClass(c.CssClasses.MandatoryMark,a.isChecked());l.toggle(a.isChecked());
b.$scoreText.add(b.$assessment).attr("aria-required",a.isChecked())});this.$loAssessmentState.change(function(){var a=b.$loAssessmentState.val()===b.rubricToggleChangeValue;b.$rubricCriterias.toggleClass(c.CssClasses.Hidden,!a)});this.$scoreText.on("keydown",function(a){return b.onScoreKeyDown(a)})}a.prototype.validateAssessmentForCompleted=function(a,c){this.isAsessmentMissingForCompleted()?c.IsValid=!1:c.IsValid=!0};a.prototype.getAssessment=function(){return this.$assessment.val()};a.prototype.getScore=
function(){return this.$scoreText.val()};a.prototype.isAsessmentMissingForCompleted=function(){var a=0<this.$completedToggle.length||0<this.$simplifiedAssessmentStatusList.length;return(this.$completedToggle.is(":checked")||this.$simplifiedAssessmentStatusList.val()===this.settings.CompletedStatusValue||!a)&&("0"===this.getAssessment()||""===this.getScore())};a.prototype.onScoreKeyDown=function(a){CCL.CommonFunctions.preventInputIncorrectCharacters(a,c.Constants.ScoreAllowedCharacters)};return a}();
e.AssessmentControl=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a,b){this.hybridEditorClientId=a;this.hybridEditorItemClientId=b;this.$hybridEditorItem=null;window[d.clientInstanceName]||(window[d.clientInstanceName]=this)}Object.defineProperty(d,"getInstance",{get:function(){return window[d.clientInstanceName]},enumerable:!0,configurable:!0});d.prototype.connectHybridEditor=function(){this.hybridEditorItem.hybridEditorItem();this.hybridEditorItem.hybridEditorItem("connectHybridEditor",this.hybridEditorClientId)};d.prototype.getText=
function(){this.hybridEditorItem.hybridEditorItem();return this.hybridEditorItem.hybridEditorItem("value")};d.prototype.setText=function(a,b){this.hybridEditorItem.hybridEditorItem();this.hybridEditorItem.hybridEditorItem("updateTextContainer",a,b);CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(this.hybridEditorItem)};d.prototype.updateInlineEditorText=function(){this.hybridEditorItem.hybridEditorItem();this.hybridEditorItem.hybridEditorItem("updateInlineEditorText")};Object.defineProperty(d.prototype,
"hybridEditorItem",{get:function(){return this.$hybridEditorItem?this.$hybridEditorItem:$("#"+this.hybridEditorItemClientId)},enumerable:!0,configurable:!0});d.clientInstanceName=c.Constants.ClientInstanceNames.HybridEditor;return d}();c.HybridEditorItemWrapper=e})(Assignment||(Assignment={}));
(function(c){(function(e){var d=function(){function a(b){var c=this;this.settings=b;this.assessment=this.score=null;window[a.clientInstanceName]||(window[a.clientInstanceName]=this);this.dialog=window[this.settings.Controls.DialogClientId];this.rubrics=window[this.settings.Controls.RubricsClientId];this.$saveButton=$("#"+this.settings.Controls.CloseButtonClientId);this.$saveButton.on("click",function(){c.close()})}Object.defineProperty(a,"getInstance",{get:function(){return window[a.clientInstanceName]},
enumerable:!0,configurable:!0});a.prototype.open=function(a,c,d,e){void 0===e&&(e=!1);var b=!1;$("span",this.dialog.getHeaderContainer()).toggle(!e);this.dialog.setTitle(e?this.settings.Terms.RubricAssessment:this.settings.Terms.AssessWithRubric);this.dialog.openDialog(!1);this.currentUserId!==a&&(this.update(c,d),b=!0);e?this.rubrics.toReadOnlyMode():this.rubrics.toAssessMode();this.currentUserId=a;this.assessment=this.score=null;return b};a.prototype.close=function(){CssModal.closeDialog();a.onClose()};
a.prototype.clear=function(){this.assessment=this.score=this.currentUserId=null};a.prototype.update=function(a,c){this.rubrics.clear();this.rubrics.update(a,c)};a.prototype.get=function(a){return a!==this.currentUserId?[]:this.rubrics.get()};a.prototype.getScore=function(a){return a!==this.currentUserId?null:this.score};a.prototype.getAssessment=function(a){return a!==this.currentUserId?null:this.assessment};a.prototype.isEmpty=function(a){return a!==this.currentUserId?!0:0===this.rubrics.get().length};
a.clientInstanceName=c.Constants.ClientInstanceNames.RubricAssessment;a.onClose=function(){$(document).trigger(c.Constants.Events.RubricAssessmentClosed)};a.onChangeScore=function(b){a.getInstance.score=b};a.onChangeAssessment=function(b){a.getInstance.assessment=b};return a}();e.RubricAssessment=d})(c.Controls||(c.Controls={}))})(Assignment||(Assignment={}));
(function(c){var e=function(){function c(a){var b=this;this.hiddenId=a.data.hiddenId;this.linkId=a.data.linkId;this.containerId=a.data.containerId;this.editorClientInstanceId=a.controls.editorClientInstanceId;if(window.opener)CKEDITOR.on("instanceReady",function(){var b=$(window.opener.document.getElementById(a.data.hiddenId));SetHtml(b.val(),a.controls.editorClientInstanceId);SetTextEditorFocus(a.controls.editorClientInstanceId);b.change(function(){$(this).parents("form").addClass(a.data.cssClasses.dirty)})});
$(a.controls.okButtonSelector).on("click",function(){return b.save()});$(a.controls.cancelButtonSelector).on("click",function(){return window.close()})}c.prototype.save=function(){if(window.opener){var a=GetTextEditorContent(this.editorClientInstanceId),b=$(window.opener.document.getElementById(this.containerId)),c=$(window.opener.document.getElementById(this.linkId)),d=$(window.opener.document.getElementById(this.hiddenId));d.val()!==a&&(b.html(a),d.val(a).trigger("change"));window.opener.TextEditorManager.refreshCustomOpenPopupButtonPosition(d,
c)}window.close()};return c}();c.Editor=e})(Assignment||(Assignment={}));var UploadStatus;(function(c){c[c.Awaiting=0]="Awaiting";c[c.InProgress=1]="InProgress";c[c.Succeeded=2]="Succeeded";c[c.SucceededWithErrors=3]="SucceededWithErrors";c[c.Failed=4]="Failed"})(UploadStatus||(UploadStatus={}));
(function(c){var e=function(){function c(a){this.settings=a}c.prototype.enablePostButtons=function(){$(this.settings.PostButtonsSelectors).each(function(a,b){$(b).removeProp("disabled")})};c.prototype.disablePostButtons=function(){$(this.settings.PostButtonsSelectors).each(function(a,b){$(b).prop("disabled",!0)})};c.prototype.onStatusChanged=function(a){switch(UploadStatus[a]){case "InProgress":this.disablePostButtons();break;case "Succeeded":case "SucceededWithErrors":case "Failed":this.enablePostButtons();
break;default:this.enablePostButtons()}};return c}();c.FileUploaderEventHandler=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a){this.settings=a;this.$contentContainer=$(a.ContainerSelector);this.answerSubmitOnBehalfControl=new c.Controls.AnswerSubmitOnBehalf(this.settings.SubmitOnBehalfSettingsModel)}d.prototype.initialise=function(){var a=this;if(this.settings.ShowActionMenu){var b=$("#"+this.settings.FileViewerEllipsisButtonIdentifier);b.get(0)&&this.createActionMenu(b)}this.settings.UseIframe?(c.AllInOneGrader.endWaitForAnswerOrFile(),$(this.settings.FrameSelector).on("load",
function(){$(a.settings.EditButtonSelector).css("display","flex")})):CCL.CommonFunctions.safeAjax({url:this.settings.ViewUrl,type:"GET"}).done(function(b){a.$contentContainer.html(b)}).always(function(){c.AllInOneGrader.endWaitForAnswerOrFile()});this.showOnboarding()};d.showPreview=function(a){window.open(a,"","width="+.8*screen.width+", height="+.8*screen.height+", location = 0, directories = 0, toolbar = 0, scrollbars = 0, status = 0, menubars = 0, resizable = 1")};d.prototype.createActionMenu=
function(a){var b=this;this.actionMenu=new CCL.ActionMenu(a,[new CCL.ActionMenuItem(this.settings.Terms.DownloadMenuItemText,"Download",function(){b.downloadClickHandler()})],new CCL.ActionMenuSettings(CCL.ActionMenuHorizontalPosition.Left,CCL.ActionMenuOpeningMode.Click,3006,!0,!0));$("."+c.CssClasses.Grader.AnswerContainer).scroll(function(){b.actionMenu.close()});this.settings.AnswerPlagiarismSettings.CanSendAnswerForPlagiarism&&this.addPlagiarismMenuItem();this.settings.SnapshotFileViewUrl&&0<
this.settings.SnapshotFileViewUrl.length&&(a=new CCL.ActionMenuItem(this.settings.Terms.ViewLastSubmittedVersionMenuItemText,"",function(){d.showPreview(b.settings.SnapshotFileViewUrl)}),this.actionMenu.addItem(a));this.settings.SubmitOnBehalfSettingsModel.SubmitOnBehalhUrl&&this.addEditAnswerMenuItem();this.settings.PlagiarismReportUrl&&this.addOpenPlagiarismReportMenuItem()};d.prototype.addPlagiarismMenuItem=function(){var a=this;this.plagiarismMenuItem=new CCL.ActionMenuItem("","SendPlagiarism",
function(){c.Controls.Answer.setUsePlagiarism(a.settings.LearningObjectId,a.settings.LearningObjectInstanceId,a.settings.AnswerId,a.plagiarismMenuItem,a.settings.AnswerPlagiarismSettings)});c.Controls.Answer.updatePlagiarismMessage(this.plagiarismMenuItem,this.settings.AnswerPlagiarismSettings);this.actionMenu.addItem(this.plagiarismMenuItem)};d.prototype.addEditAnswerMenuItem=function(){var a=new CCL.ActionMenuItem(this.settings.SubmitOnBehalfSettingsModel.EditAnswerTerm,"EditAnswer",this.answerSubmitOnBehalfControl.openSubmitOnBehalfDialog);
this.actionMenu.addItem(a)};d.prototype.addOpenPlagiarismReportMenuItem=function(){var a=this,b=new CCL.ActionMenuItem(this.settings.Terms.OpenPlagiarismReport,"OpenPlagiarismReport",function(){c.PlagiarismReport.openPlagiarismReport(a.settings.PlagiarismReportUrl)});this.actionMenu.addItem(b)};d.prototype.downloadClickHandler=function(){window.open(this.settings.DownloadUrl)};d.prototype.showOnboarding=function(){var a=this,b=window[this.settings.FileViewerOnboardingDialogIdentifier];b&&(b.setCustomScripts({afterCloseDialog:function(){CCL.CommonFunctions.safeAjaxPost({url:a.settings.OnboardingUrl,
data:{settingName:c.Constants.UserSettingsKey.IsGoogleDocOnboardingCompleted,settingValue:"true"},headers:CCL.CommonFunctions.getAntiForgeryAjaxHeader({headerName:a.settings.AntiForgerySettings.HeaderName,headerValue:a.settings.AntiForgerySettings.HeaderValue})})}}),b.openDialog(!1))};return d}();c.FileViewer=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a){this.containerSelector=a}d.prototype.show=function(a,b){void 0===b&&(b="");CCL.InformationFeedback.showFeedback($(this.containerSelector),this.generateMessage(a,b),{disableAutomaticHiding:!0});return this};d.prototype.showWithButton=function(a,b,c,d,e){void 0===e&&(e=!0);CCL.CommonFunctions.isPhoneScreenSize()&&e?this.show(a,b).hide(5E3):CCL.InformationFeedback.showFeedback($(this.containerSelector),this.generateMessage(a,b),{disableAutomaticHiding:!0,extraButtonName:c,
extraButtonCallback:d});return this};d.prototype.hide=function(a){var b=this;void 0===a&&(a=0);setTimeout(function(){return CCL.InformationFeedback.hideFeedback($(b.containerSelector))},a);return this};d.prototype.generateMessage=function(a,b){return"<span class='"+(""===b?c.CssClasses.Common.InformationFeedbackMessage:"")+"' style='"+(""===b?"":"font-weight:bold; display: block;")+"'>"+a+"</span>"+b};return d}();c.InformationFeedbackWrapper=e})(Assignment||(Assignment={}));
(function(c){(function(c){var d=function(){function a(a,c,d,e){var b=this;void 0===e&&(e=null);this.nextStep=null;this.start=function(){b.controller.start()};this.startNextStep=function(){b.nextStep?b.nextStep.start():b.controller.next()};this.onboardingNotComplete=function(){var a=window[b.onboardingDialogId];a.isMobileView()||CCL.CommonFunctions.isMobileDevice()||($(window).on("resize",b.resizeHandler),a.blockHighlightZone=!0,a.openDialog(b.onboardingCloseHandler),b.overlay(!0))};this.onboardingComplete=
function(){b.startNextStep()};this.onboardingCloseHandler=function(a){$(window).off("resize",b.resizeHandler);a?b.controller.complete(b.featuresForComplete):b.startNextStep();b.controller.complete();b.overlay(!1)};this.resizeHandler=function(){var a=window[b.onboardingDialogId];a.isOpen&&a.isMobileView()&&(b.overlay(!1),$(window).off("resize",b.resizeHandler))};this.cssClasses=a;this.onboardingDialogId=c;this.featureId=d;this.controller=new CCL.Onboarding.Extensions.OnboardingPostMessageController(this.featureId,
e,this.onboardingComplete,this.onboardingNotComplete)}a.prototype.overlay=function(a){this.controller.overlay(a);$(document.body).toggleClass(this.cssClasses.Overlay,a)};return a}();c.Step=d})(c.Onboarding||(c.Onboarding={}))})(Assignment||(Assignment={}));
(function(c){(function(c){var d=CCL.Onboarding.Extensions.OnboardingFeatures,a=function(){function a(){}a.prototype.init=function(a,b){var f=new c.Step(b,a.getStartedDialogClientId,d.AssignmentGetStarted);f.featuresForComplete=[d.AssignmentEdit,d.AssignmentLearningToolOptions,d.AssignmentReminders];b=new c.Step(b,a.editAssignmentDialogClientId,d.AssignmentEdit,d.AssignmentLearningToolOptions);b.featuresForComplete=[d.AssignmentLearningToolOptions,d.AssignmentReminders];CCL.IframeContentHeightReporter.addSelectorToListenHeight("."+
a.Dialog);f.nextStep=b;f.start()};return a}();c.Tour=a})(c.Onboarding||(c.Onboarding={}))})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a){var b=this;this.selectedUserIds=[];this.renderItem=function(a,d){return $("<li>").append(d.metadata?$('<a>\n                            <img alt="" class="'+c.CssClasses.Common.PersonProfileImage+'" src="'+b.getImageUrl(d.metadata)+'" />\n                       </a>').append($("<span/>").text(d.label)):"<span>"+b.settings.Terms.NoMatches+"</span>").appendTo(a)};this.onPeerSelected=function(a,c){c&&b.addPeer(c)};this.addPeer=function(a){var d=b.getImageUrl(a),
e=$('<div class="'+c.CssClasses.AddPeerDialog.Row+'" data-id="'+a.UserId+'"></div>');d=$('<div class="'+c.CssClasses.AddPeerDialog.Image+'"><img alt="" src="'+d+'" class="'+c.CssClasses.Common.PersonProfileImage+'"></div>');var f=$('<div class="'+c.CssClasses.AddPeerDialog.Name+'"></div>'),m=$('<div class="'+c.CssClasses.AddPeerDialog.Remove+'"></div>'),l=$('<a href="#">&times;</a>').prop("title",CCL.CommonFunctions.formatString(b.settings.Terms.RemoveX,a.FullName));m.append(l);l.click(b.onRemoveClick);
f.append($("<span></span>").text(a.FullName));e.data("metadata",a).append(d).append(f).append(m);$("#"+b.settings.Controls.SelectedPeersListClientId).append(e);b.selectedUserIds.push(a.UserId)};this.onRemoveClick=function(a){var d=$(a.target).parents("."+c.CssClasses.AddPeerDialog.Row);d.hide("fast",function(){var a=parseInt(d.attr("data-id"));b.selectedUserIds=b.selectedUserIds.filter(function(b){return b!==a});d.remove()});return!1};this.addSelectedPeers=function(){$.ajax({type:"PUT",url:b.settings.AddPeersApiUrl,
data:JSON.stringify({peerUserIds:b.selectedUserIds}),contentType:"application/json;charset=utf-8"}).done(function(){b.refreshGrid();b.cancelHandler();b.settings.RefreshAnswersGridOnAdd&&$(document).trigger(c.Constants.Events.AnswersGridDataChanged)});return!1};this.cancelHandler=function(){b.selectedUserIds=[];$("#"+b.settings.Controls.SelectedPeersListClientId).children("div").remove();CssModal.closeDialog();return!1};this.refreshGrid=function(){$.ajax({type:"GET",url:b.settings.TargetGridApiUrl}).done(function(a){$("#"+
b.settings.TargetGridClientId).html(a)}).fail(function(){alert(b.settings.Terms.ErrorOccured)})};this.doSearch=function(a,c){a=b.settings.SearchPeersApiUrl+encodeURIComponent(a.term);$.ajax({url:a,type:"POST",data:JSON.stringify({peerUserIds:b.selectedUserIds}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(a){0<a.length?c($.map(a,function(a){return{label:a.FullName,value:a.PersonId,metadata:a}})):c([{}])}).fail(function(){alert(b.settings.Terms.ErrorOccured)})};this.settings=
a;this.eventToHandle=a.LabeledInputSelectEventName+":"+a.PeerSearchType;$(function(){$(document).off(b.eventToHandle).on(b.eventToHandle,b.onPeerSelected);$("#"+b.settings.Controls.AddPeerButtonClientId).click(b.addSelectedPeers);$("#"+b.settings.Controls.CancelButtonClientId).click(b.cancelHandler);window[b.settings.Controls.AddPeerDialogClientId].setCustomScripts({afterOpenDialog:function(){$("#"+b.settings.Controls.PeerSearchInputControlClientId).focus()},afterCloseDialog:function(){return b.cancelHandler()}})})}
d.prototype.getImageUrl=function(a){return a.ProfilePictureUrl?a.ProfilePictureUrl:this.settings.DefaultProfilePictureUrl};return d}();c.AddPeersControl=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a,b){var c=this;this.viewerCallback=b;this.options=a;if(b=document.getElementById(a.FileListClientId))b.addEventListener(a.Events.FileSelected,function(a){return c.handleItemSelected(a)}),b.addEventListener(a.Events.FileViewActivated,function(a){return c.handleItemViewActivated(a)}),b.addEventListener(a.Events.FileViewOriginalActivated,function(a){return c.handleItemViewOriginalActivated(a)}),b.addEventListener(a.Events.OpenPlagiarismReport,function(a){return d.openPlagiarismReport(a)})}
d.prototype.handleItemSelected=function(a){this.preview(a)};d.prototype.handleItemViewActivated=function(a){this.preview(a)};d.prototype.handleItemViewOriginalActivated=function(a){this.preview(a,!0)};d.prototype.preview=function(a,b){void 0===b&&(b=!1);a=a.detail;var c=a.File;if(c){var d=c.PreviewSettings;if(d&&d.Type){var e=d.Url;if(e&&b){e=e.replace(c.Metadata.id,c.SnapshotFileRepoId);var h=encodeURIComponent(encodeURIComponent(c.Metadata.signedFileRepoId));c=encodeURIComponent(encodeURIComponent(c.SnapshotFileRepoSignature));
e=e.replace(new RegExp(h,"gi"),c)}d.Type!==CCL.PreviewType.Custom&&d.Type!==CCL.PreviewType.Modal||!d.Url||b?a.DefaultHandler&&a.DefaultHandler():this.viewerCallback(e)}}};d.openPlagiarismReport=function(a){a=a.detail;a.File&&a.File.Metadata&&(a=a.File.Metadata,a.PlagiarismReportUrl&&c.PlagiarismReport.openPlagiarismReport(a.PlagiarismReportUrl))};return d}();c.FileList=e})(Assignment||(Assignment={}));
(function(c){var e;(function(a){a[a.Reviewers=0]="Reviewers";a[a.ForReview=1]="ForReview"})(e||(e={}));var d=function(){function a(a){var b=this;this.peerAssessmentAssessorDeleted=function(a,c,d){b.deletePeerReviewer(c,d,e.Reviewers,a.target)};this.peerAssessmentPeerToReviewDeleted=function(a,c,d){b.deletePeerReviewer(c,d,e.ForReview,a.target)};this.settings=a;$(function(){if(b.settings.Events.PeerAssessmentAssessorDeleted)$(document).off(b.settings.Events.PeerAssessmentAssessorDeleted).on(b.settings.Events.PeerAssessmentAssessorDeleted,
b.peerAssessmentAssessorDeleted);if(b.settings.Events.PeerAssessmentPeerToReviewDeleted)$(document).off(b.settings.Events.PeerAssessmentPeerToReviewDeleted).on(b.settings.Events.PeerAssessmentPeerToReviewDeleted,b.peerAssessmentPeerToReviewDeleted)})}a.prototype.deleteRow=function(a,b){var c=this,d=$("a[data-action='"+a[0].id+"']").closest("tr");if(b)d.hide("fast",function(){d.remove()});else{var e=d.children().length;d.hide("fast",function(){d.empty();$("<td>",{colspan:e,"class":c.settings.CssClasses.EmptyRow}).appendTo(d).text(c.settings.Terms.EmptyGridMessage);
d.show("fast")})}};a.prototype.deletePeerReviewer=function(a,b,d,h){var f=this;confirm(this.settings.Terms.RemovePeerReviewerConfirmationMessage)&&$.ajax({url:this.settings.Urls.PeerAssessorControllerUrl,type:"DELETE",data:JSON.stringify({answerId:a,userId:b,searchType:d}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(a){f.deleteRow($(h),a);d===e.Reviewers&&$(document).trigger(c.Constants.Events.AnswersGridDataChanged)}).fail(function(){return alert(f.settings.Terms.ErrorOccured)})};
return a}();c.PeerAssessmentGridManager=d;d=function(){return function(a){this.events=a}}();c.PeerAssessmentGrid=d;var a=function(a){function b(b){a.call(this,b)}__extends(b,a);b.prototype.triggerDeleteEvent=function(a,b,c){$("#"+c).trigger(this.events.PeerAssessmentAssessorDeleted,[a,b])};return b}(d);c.AssessorsGrid=a;d=function(a){function b(b){a.call(this,b)}__extends(b,a);b.prototype.triggerDeleteEvent=function(a,b,c){$("#"+c).trigger(this.events.PeerAssessmentPeerToReviewDeleted,[a,b])};return b}(d);
c.PeersToReviewGrid=d})(Assignment||(Assignment={}));(function(c){var e=function(){function c(){}c.openPlagiarismReport=function(a){window.open(a,"_blank")};return c}();c.PlagiarismReport=e})(Assignment||(Assignment={}));
(function(c){var e=function(d){function a(b,e,g){var f=this;d.call(this);this.settings=b;this.headersList=e;b.controls.onboarding.isOnboardingEnabled&&(new c.Onboarding.Tour).init(b.controls.onboarding,b.data.onboardingCssClasses);this.currentZipTaskInfo=b.data.currentZipTaskInfo;this.gridEmptyTableCell=b.data.cssClasses.gridEmptyTableCell;this.$feedback=$("#"+b.controls.feedbackId);this.$feedbackText=$("#"+b.controls.feedbackTextId);this.$feedbackClose=$("#"+b.controls.feedbackCloseId);this.$warningFeedback=
$("#"+b.controls.warningFeedbackId);this.$warningFeedbackText=$("#"+b.controls.warningFeedbackTextId);this.$errorFeedback=$("#"+b.controls.errorFeedbackId);this.$errorFeedbackText=$("#"+b.controls.errorFeedbackTextId);this.$itemDownloadAnswersLink=$("#"+this.settings.controls.itemDownloadAnswersLink);$("#"+this.settings.controls.deleteSelectedAnswersLink).click(function(a){return f.checkBeforeDeleteAnswers(a)});$("#"+this.settings.controls.downloadAnswersLink).click(function(a){return f.checkBeforeDownload(a)});
$("#"+this.settings.controls.assessMultipleLink).click(function(){return f.checkBeforeAssess()});this.$feedbackClose.click(this.deleteExistingZiptaskAnswers.bind(this));$("#"+b.controls.gridTableId+" "+b.controls.gridClickableRowSelector).on("clickableRowClicked",function(a){return f.onGridClickableClick(a)});$("#"+b.controls.gridTableId+" "+b.controls.gridClickableRowSelector+" button["+a.assessLinkDataAttribute+"]").on("click",function(a){return f.onGridClickableClick(a)}).on("focus",function(a){$(a.target).closest("tr").addClass(CCL.CommonCssClasses.Grid.FocusedRow)}).on("blur",
function(a){$(a.target).closest("tr").closest("tr").removeClass(CCL.CommonCssClasses.Grid.FocusedRow)});this.settings.data.reloadSidebar&&this.postMessage(CCL.CommonWindowMessages.MessageNames.extensionContentChanged);this.updateUi();this.currentZipTaskInfo.isValid&&this.startPolling();this.settings.data.showWarningIfAnonymousSubmissionAndGoogleFiles&&(this.$warningFeedbackText.html(this.settings.terms.anonymousSubmissionWithTemplateWarning),this.$warningFeedbackText.show(),this.$warningFeedback.show());
CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.studentWasAssessed,function(){window.location=window.location});CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.showSettings));$(document).on(b.data.kpi.calculateEvent,$.proxy(function(){CCL.CommonFunctions.measureKpi(b.urls.measureKpi,b.data.kpi.measureSection,b.data.kpi.measurement)},this));e=new c.Controls.Tooltip("draftTooltip",
$("#"+b.controls.draftTooltipContentId));new c.Controls.TooltipToggler($("."+b.data.cssClasses.draftIndicator),e);e=new c.Controls.Tooltip("submittedLateTooltip",$("#"+b.controls.submittedLateTooltipContentId));new c.Controls.TooltipToggler($("."+b.data.cssClasses.submittedTooLateIndicator),e);g&&g.UserId&&0<g.UserId&&$(function(){window[c.Constants.ClientInstanceNames.AllInOneGrader].open(g)})}__extends(a,d);a.prototype.onGridClickableClick=function(b){b=$(b.currentTarget).parents("tr").find("button.h-hidden");
0<b.length&&(b=JSON.parse(b.attr(a.assessLinkDataAttribute)),window[c.Constants.ClientInstanceNames.AllInOneGrader].open(b,this.headersList))};a.prototype.updateUi=function(){if(!1===this.currentZipTaskInfo.isValid)this.$feedbackText.html(""),this.stopPolling(),this.$feedbackClose.show();else switch(this.currentZipTaskInfo.status){case this.settings.data.status.NotStarted:case this.settings.data.status.Waiting:case this.settings.data.status.InProgress:case this.settings.data.status.InProgressExternal:this.$feedbackText.html(this.settings.data.downloadingMessageTemplate);
break;case this.settings.data.status.Ok:var a=this.settings.terms.readyMessageTemplate;a=a.replace(this.settings.data.fileRepoToken,encodeURIComponent(this.currentZipTaskInfo.result));this.$feedbackText.html(a);this.stopPolling();this.$feedbackClose.show();this.$feedback.show();this.$itemDownloadAnswersLink.show();break;case this.settings.data.status.Error:this.stopPolling(),this.$feedback.hide(),this.$itemDownloadAnswersLink.show(),this.$errorFeedbackText.html(this.currentZipTaskInfo.result),this.$errorFeedback.show()}};
a.prototype.checkAsyncTaskStatusAndUpdateUi=function(){var a=this;$.ajax({type:"GET",url:this.settings.urls.serviceUrl,dataType:"json"}).done(function(b){a.currentZipTaskInfo.status!==b.Status&&(a.currentZipTaskInfo.status=b.Status,a.currentZipTaskInfo.result=b.Result,a.updateUi())}).fail(function(){a.stopPolling();a.$feedback.hide();a.$errorFeedbackText.html(a.settings.terms.errorOccured);a.$errorFeedback.show()})};a.prototype.checkStatus=function(){this.currentZipTaskInfo.isValid&&this.checkAsyncTaskStatusAndUpdateUi()};
a.prototype.startPolling=function(){this.pollingIntervalId=setInterval(this.checkStatus.bind(this),this.settings.data.pollingInterval)};a.prototype.stopPolling=function(){clearInterval(this.pollingIntervalId)};a.prototype.deleteExistingZiptaskAnswers=function(){CCL.CommonFunctions.safeAjax({url:this.settings.urls.deleteExistingZipAnswerstask,type:"DELETE",dataType:"json"})};a.prototype.checkBeforeDeleteAnswers=function(a){return 0===window[this.settings.controls.gridId].getSelectedValues().length?
(alert(this.settings.terms.selectMessage),!1):confirm(this.settings.terms.deleteAnswersQuestion)};a.prototype.checkBeforeAssess=function(){return 0===window[this.settings.controls.gridId].getSelectedValues().length?(alert(this.settings.terms.selectMessage),!1):!0};a.prototype.checkBeforeDownload=function(a){var b=this;return this.checkBeforeActionOnAnswers(a,function(a){a?(new Function(b.settings.controls.downloadAnswersPostbackRef))():alert(b.settings.terms.nothingToDownload)})};a.prototype.checkBeforeActionOnAnswers=
function(a,c){var b=window[this.settings.controls.gridId].getSelectedValues(),d=$(a.currentTarget);if(d.hasClass("disabled"))return!1;if(0===b.length)return alert(this.settings.terms.selectMessage),!1;d.addClass("disabled");this.checkIfAnyAnswersExist(b,d,function(a){c(a);d.removeClass("disabled");d.parent("li").trigger("click")});return!1};a.prototype.checkIfAnyAnswersExist=function(a,c,d){var b=this;$.ajax({url:this.settings.urls.isAnyAnswerSubmittedByUsers,contentType:"application/json",dataType:"json",
type:"POST",data:JSON.stringify({assignmentId:this.settings.data.assignmentId,assignmentInstanceId:this.settings.data.assignmentInstanceId,userIds:a})}).done(function(a){d(a)}).fail(function(){c.removeClass("disabled");alert(b.settings.terms.errorOccured)})};a.assessLinkDataAttribute="data-for-grader";return a}(c.Base);c.Read=e})(Assignment||(Assignment={}));
(function(c){var e=function(d){function a(a){var b=this;d.call(this,new c.BaseEditSettings(a.data.terms.navigateAwayMessage));this.settings=a;this.postMessageToHideSettings();new CCL.ButtonLoadingIndicator(this.settings.controls.okButtonSelector,this.settings.data.cssClasses.inProgressClass);$(this.settings.controls.okButtonSelector).click(function(){if(!IsEditorEmpty(a.controls.textEditorId)&&b.settings.data.hasAnyComment&&!confirm(b.settings.data.terms.feedbackWarningMessage))return b.removeLoadingIndicator(),
!1;b.okHandler()});$("form").submit(function(){$(b.settings.controls.okButtonSelector).addClass(b.settings.data.cssClasses.buttonDisabled).prop("disabled",!1);return!0})}__extends(a,d);a.prototype.okHandler=function(){!1===window.Page_IsValid&&this.removeLoadingIndicator()};a.prototype.removeLoadingIndicator=function(){$(this.settings.controls.okButtonSelector).trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator)};return a}(c.BaseEdit);c.AssessMultiple=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function d(a){var b=this;this.settings=a;window[a.ClientInstanceName]||(window[a.ClientInstanceName]=this);this._dialog=window[a.DialogClientInstanceName];this.$dialogElement=$("#"+a.DialogClientInstanceName);this._dialog.setCustomScripts({afterOpenDialogAjaxDynamicallySuccess:function(){return b.attachEventHandlers()},afterCloseDialog:function(){return Annotations.AnnotationApp.clearPdfViewerInstance()}});d.$cssModalContent=this.$dialogElement.find("."+this.settings.CssClasses.CssModalContent);
this.$dialogElement.on("click","."+this.settings.CssClasses.FileViewerBackLink,function(){Annotations.AnnotationApp.clearPdfViewerInstance();b.loadPreviousPage()})}d.prototype.open=function(a){this._dialog&&(this._dialog.setAjaxUrl(a,{},!1),this._dialog.openDialog(!1),this.initialUrl=a,d.scrollTop=0)};d.loadViewer=function(a){window[c.Constants.ClientInstanceNames.ReviewPeerAssessmentDialog]&&(d.scrollTop=d.$cssModalContent.scrollTop(),window[c.Constants.ClientInstanceNames.ReviewPeerAssessmentDialog].setAjaxUrl(a,
{},!0))};d.prototype.loadPreviousPage=function(){this.initialUrl&&this._dialog.setAjaxUrl(this.initialUrl,{},!0)};d.prototype.attachEventHandlers=function(){var a=this.$dialogElement.find("."+this.settings.CssClasses.PeerAssessmentContentContainer);Tools.ExpandableSection.attachHandlerOnContainer(a);0!==a.length&&d.$cssModalContent.scrollTop(d.scrollTop)};d.scrollTop=0;return d}();c.ReviewPeerAssessment=e})(Assignment||(Assignment={}));
(function(c){var e=function(){return function(){}}();c.SectionExpanderSettings=e;e=function(){return function(c){var a=c.expander.children("span.as-expander-text");c.expander.click(function(){c.target.toggleClass(c.cssClasses.sectionExpanderHide);var b=!c.target.hasClass(c.cssClasses.sectionExpanderHide);a.text(b?c.terms.hide:c.terms.show);c.expander.toggleClass("expanded",b);c.expander.hasClass("as-section-expander-with-arrow")&&c.expander.closest("."+c.cssClasses.box).toggleClass(c.cssClasses.noPrint,
!b)})}}();c.SectionExpander=e})(Assignment||(Assignment={}));
(function(c){var e=function(c){function a(a){var b=this;c.call(this);this.settings=a;$("#"+this.settings.controls.deleteAnswerButton).on("click",function(){return b.checkBeforeDeleteAnswer()});null!==this.settings.controls.commentModule&&(a=$("#"+this.settings.controls.commentModule).getCommentModuleObject())&&a.loadAndShow()}__extends(a,c);a.prototype.checkBeforeDeleteAnswer=function(){var a=this;confirm(this.settings.terms.deleteAnswerQuestion)&&CCL.CommonFunctions.safeAjax({type:"DELETE",url:this.settings.urls.deleteAnswerUrl}).done(function(){a.postMessage(CCL.CommonWindowMessages.MessageNames.extensionContentChanged,
{expandRead:a.settings.data.isCollaborationsUsed});window.location.href=window.location.href}).fail(function(){return alert(a.settings.terms.errorOccured)});return!1};return a}(c.Base);c.StudentView=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function c(a){window[c.clientInstanceName]=this;this.settings=a;this.isFirstFunctionCall=!0;var b=this;if("undefined"!==typeof CKEDITOR)CKEDITOR.on("instanceReady",function(a){a=CKEDITOR.instances[b.settings.EditorClientInstanceId];b.settings.Label&&a.container.setAttribute("aria-label",b.settings.Label);if(b.isFirstFunctionCall&&"ready"===a.status){if(b.settings.IsToolbarExpanded){var c=a.getCommand(b.settings.ToolbarExpandedCommandName),d=c.editorFocus;c.editorFocus=
!1;a.execCommand(b.settings.ToolbarExpandedCommandName);c.editorFocus=d}a.on(b.settings.ToolbarExpandedEvent,function(a){b.toggleToolbar(a.data.expanded)});b.isFirstFunctionCall=!1;a.on("key",function(a){a.data.keyCode===CCL.CommonConstants.keyCodes.escape&&(window.location.href=b.settings.CssModalDefaultTarget)})}})}c.prototype.toggleToolbar=function(a){CCL.CommonFunctions.safeAjaxPost({dataType:"json",url:this.settings.SetUserPreferenceWebMethods,data:{category:this.settings.PageName,name:this.settings.EditorKeyForPreferences,
value:a}})};c.getEditorClientInstanceId=function(){return window[c.clientInstanceName].settings.EditorClientInstanceId};c.getEditorContent=function(){return GetTextEditorContent(c.getEditorClientInstanceId()).replace(/\n\n/g,"\n").replace(/\t/g," ")};c.setEditorContent=function(a){SetHtml(a,c.getEditorClientInstanceId())};c.clientInstanceName="TextEditorWrapperClientInstanceName";return c}();c.TextEditorWrapper=e})(Assignment||(Assignment={}));
(function(c){var e=function(){function c(){}c.widont=function(a,b){0>=b||$(function(){$(a).each(function(a,c){var d=$(c).html().trim().split(" ");a=d.splice(-b,b).join("&nbsp;");d=d.join(" ");$(c).html(d+" "+a)})})};return c}();c.TextFormatting=e})(Tools||(Tools={}));
(function(c){var e=function(){function d(a){this.listenForPrintPostMessage=function(a){CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.extensionPrintContentFrame,function(b){null!=b&&(document.title=b.headerText,$(a.controls.clientID).html(b.headerHtml));$("."+a.data.cssClasses.criteriaDescriptionRow).removeClass(a.data.cssClasses.NoPrint);$("."+a.data.cssClasses.criteriaDescriptionRow+":has("+a.data.cssClasses.emptyState+")").addClass(a.data.cssClasses.noPrint);
if("undefined"!==typeof CKEDITOR&&null!=CKEDITOR.instances)for(var c in CKEDITOR.instances)b=CKEDITOR.instances[c],$(b.container.$).find(".cke_top").addClass(a.data.cssClasses.noPrint),$(b.container.$).find(".cke_bottom").addClass(a.data.cssClasses.noPrint),""===b.getData()?$("."+a.data.cssClasses.feedbackTextEditorPanel).addClass(a.data.cssClasses.noPrint):$("."+a.data.cssClasses.feedbackTextEditorPanel).removeClass(a.data.cssClasses.noPrint);CCL.CommonFunctions.isFirefox()&&(window.onbeforeprint=
function(){$("."+a.data.cssClasses.fieldsetPrinting+" fieldset").each(function(){$(this).replaceWith($('<div class="fieldset">'+this.innerHTML+"</div>"))})},window.onafterprint=function(){$("."+a.data.cssClasses.fieldsetPrinting+" .fieldset").each(function(){$(this).replaceWith($("<fieldset>"+this.innerHTML+"</fieldset>"))})});window.focus();window.print();$(document).trigger(a.data.calculateMeasureKpiEvent)})};this.listenForFullScreenPostMessages=function(){CCL.CommonFunctions.attachPostMessageEventListener($(window),
CCL.CommonWindowMessages.MessageNames.enableFullScreen,function(){window.parent!==window&&CCL.CommonFunctions.makePostMessageCall(window.parent,{messageName:CCL.CommonWindowMessages.MessageNames.enableFullScreen});CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessageWithData(CCL.CommonWindowMessages.MessageNames.extensionContentOpened,{iframeWidth:-1,iframeHeight:-1}));CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessageWithData(CCL.CommonWindowMessages.MessageNames.iframeAutoHeight,
{enabled:!0}))});CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.disableFullScreen,function(){window.parent!==window&&CCL.CommonFunctions.makePostMessageCall(window.parent,{messageName:CCL.CommonWindowMessages.MessageNames.disableFullScreen});CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessageWithData(CCL.CommonWindowMessages.MessageNames.iframeAutoHeight,{enabled:!1}))})};$.ajaxSetup({cache:!1});this.listenForPrintPostMessage(a);
this.listenForFullScreenPostMessages();var b=navigator.userAgent.match(/Trident.*rv:11\./);CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.extensionSettingsChanged,function(){b||(window.location=window.location)});Tools.TextFormatting.widont("."+c.CssClasses.Common.Widont,3)}d.beforePrintCallback=function(a){return $(this).each(function(){if(void 0!==window.onbeforeprint)$(window).on("beforeprint",a);else window.matchMedia&&window.matchMedia("print").addListener(a)})};
d.afterPrintCallback=function(a){return $(this).each(function(){if(void 0!==window.onafterprint)$(window).on("afterprint",a);else if(window.matchMedia)$(window).one("mouseover",a)})};return d}();c.Master=e})(Assignment||(Assignment={}));
